<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <!--
        This file is autogenerated from docs/glib-adoption.rst
        Do not edit this file. Changes will be lost.
      -->
  <!--
        This page was generated at Wed Apr 19 07:14:27 2023 UTC.
      -->
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" type="text/css" href="css/main.css"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/>
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/>
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/>
    <link rel="manifest" href="/manifest.json"/>
    <meta name="theme-color" content="#ffffff"/>
    <title>libvirt: Adoption of GLib APIs</title>
    <meta name="description" content="libvirt, virtualization, virtualization API"/>
    <script type="text/javascript" src="js/main.js">
      <!--// forces non-empty element-->
    </script>
  </head>
  <body onload="pageload()">
    <div id="body">
      <div class="document" id="adoption-of-glib-apis">
<h1>Adoption of GLib APIs</h1>

<p>Libvirt has adopted use of the <a class="reference external" href="https://developer.gnome.org/glib/stable/">GLib
library</a>. Due to
libvirt's long history of development, there are many APIs in
libvirt, for which GLib provides an alternative solution. The
general rule to follow is that the standard GLib solution will be
preferred over historical libvirt APIs. Existing code will be
ported over to use GLib APIs over time, but new code should use
the GLib APIs straight away where possible.</p>
<p>The following is a list of libvirt APIs that should no longer be
used in new code, and their suggested GLib replacements:</p>
<dl>
<dt>Memory allocation</dt>
<dd><p><span class="docutils literal">VIR_ALLOC</span>, <span class="docutils literal">VIR_REALLOC</span>, <span class="docutils literal">VIR_RESIZE_N</span>,
<span class="docutils literal">VIR_EXPAND_N</span>, <span class="docutils literal">VIR_SHRINK_N</span>, <span class="docutils literal">VIR_FREE</span></p>
<p><a class="reference external" href="https://developer.gnome.org/glib/stable/glib-Memory-Allocation.html">https://developer.gnome.org/glib/stable/glib-Memory-Allocation.html</a></p>
<p>Prefer the GLib APIs <span class="docutils literal">g_new0</span>/<span class="docutils literal">g_renew</span>/ <span class="docutils literal">g_free</span> in most
cases. There should rarely be a need to use
<span class="docutils literal">g_malloc</span>/<span class="docutils literal">g_realloc</span>. <strong>NEVER MIX</strong> use of the classic
libvirt memory allocation APIs and GLib APIs within a single
method. Keep the style consistent, converting existing code to
GLib style in a separate, prior commit.</p>
</dd>
<dt>Array operations</dt>
<dd><p><span class="docutils literal">VIR_APPEND_ELEMENT</span>, <span class="docutils literal">VIR_INSERT_ELEMENT</span>, <span class="docutils literal">VIR_DELETE_ELEMENT</span></p>
<p><a class="reference external" href="https://developer.gnome.org/glib/stable/glib-Arrays.html">https://developer.gnome.org/glib/stable/glib-Arrays.html</a></p>
<p>Instead of using plain C arrays, it is preferrable to use one of
the GLib types, <span class="docutils literal">GArray</span>, <span class="docutils literal">GPtrArray</span> or <span class="docutils literal">GByteArray</span>.
These all use a struct to track the array memory and size
together and efficiently resize.</p>
</dd>
<dt>String arrays</dt>
<dd><p><span class="docutils literal">virStringList*</span>, <span class="docutils literal">virStringListCount*</span></p>
<p><a class="reference external" href="https://developer.gnome.org/glib/stable/glib-String-Utility-Functions.html">https://developer.gnome.org/glib/stable/glib-String-Utility-Functions.html</a></p>
<p>Prefer the NULL-terminated variant instead of storing the count
separately. Prefer <span class="docutils literal">g_str*v</span> functions instead of their <span class="docutils literal">vir*</span>
counterparts. For use with <span class="docutils literal">g_auto</span> GLib provides the <span class="docutils literal">GStrv</span> type.</p>
</dd>
<dt>Objects</dt>
<dd><p><span class="docutils literal">virObject</span></p>
<p><a class="reference external" href="https://developer.gnome.org/gobject/stable/gobject-The-Base-Object-Type.html">https://developer.gnome.org/gobject/stable/gobject-The-Base-Object-Type.html</a></p>
<p>Prefer <span class="docutils literal">GObject</span> instead.</p>
</dd>
</dl>
</div>
    </div>
    <div id="nav">
      <div id="home">
        <a href="index.html">Home</a>
      </div>
      <div id="jumplinks">
        <ul>
          <li>
            <a href="downloads.html">Download</a>
          </li>
          <li>
            <a href="contribute.html">Contribute</a>
          </li>
          <li>
            <a href="docs.html">Docs</a>
          </li>
        </ul>
      </div>
      <div id="search">
        <form id="simplesearch" action="https://www.google.com/search" enctype="application/x-www-form-urlencoded" method="get">
          <div>
            <input id="searchsite" name="sitesearch" type="hidden" value="libvirt.org"/>
            <input id="searchq" name="q" type="text" size="12" value=""/>
            <input name="submit" type="submit" value="Go"/>
          </div>
        </form>
        <div id="advancedsearch">
          <span>
            <input type="radio" name="what" id="whatwebsite" checked="checked" value="website"/>
            <label for="whatwebsite">Website</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatwiki" value="wiki"/>
            <label for="whatwiki">Wiki</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatdevs" value="devs"/>
            <label for="whatdevs">Developers list</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatusers" value="users"/>
            <label for="whatusers">Users list</label>
          </span>
        </div>
      </div>
    </div>
    <div id="footer">
      <div id="contact">
        <h3>Contact</h3>
        <ul>
          <li>
            <a href="contact.html#mailing-lists">email</a>
          </li>
          <li>
            <a href="contact.html#irc">irc</a>
          </li>
        </ul>
      </div>
      <div id="community">
        <h3>Community</h3>
        <ul>
          <li>
            <a href="https://twitter.com/hashtag/libvirt">twitter</a>
          </li>
          <li>
            <a href="https://stackoverflow.com/questions/tagged/libvirt">stackoverflow</a>
          </li>
          <li>
            <a href="https://serverfault.com/questions/tagged/libvirt">serverfault</a>
          </li>
        </ul>
      </div>
      <div id="contribute">
        <h3>Contribute</h3>
        <ul>
          <li>
            <a href="https://gitlab.com/libvirt/libvirt/-/blob/master/docs/glib-adoption.rst">edit this page</a>
          </li>
        </ul>
      </div>
      <div id="conduct">
            Participants in the libvirt project agree to abide by <a href="governance.html#code-of-conduct">the project code of conduct</a></div>
      <br class="clear"/>
    </div>
  </body>
</html>
