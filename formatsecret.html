<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <!--
        This file is autogenerated from docs/formatsecret.rst
        Do not edit this file. Changes will be lost.
      -->
  <!--
        This page was generated at Wed Apr 19 07:14:27 2023 UTC.
      -->
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" type="text/css" href="css/main.css"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/>
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/>
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/>
    <link rel="manifest" href="/manifest.json"/>
    <meta name="theme-color" content="#ffffff"/>
    <title>libvirt: Secret XML format</title>
    <meta name="description" content="libvirt, virtualization, virtualization API"/>
    <script type="text/javascript" src="js/main.js">
      <!--// forces non-empty element-->
    </script>
  </head>
  <body onload="pageload()">
    <div id="body">
      <div class="document" id="secret-xml-format">
<h1>Secret XML format</h1>

<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#secret-xml" id="id1">Secret XML</a></p>
<ul>
<li><p><a class="reference internal" href="#usage-type-volume" id="id2">Usage type "volume"</a></p></li>
<li><p><a class="reference internal" href="#usage-type-ceph" id="id3">Usage type "ceph"</a></p></li>
<li><p><a class="reference internal" href="#usage-type-iscsi" id="id4">Usage type "iscsi"</a></p></li>
<li><p><a class="reference internal" href="#usage-type-tls" id="id5">Usage type "tls"</a></p></li>
<li><p><a class="reference internal" href="#usage-type-vtpm" id="id6">Usage type "vtpm"</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#setting-secret-values-in-virsh" id="id7">Setting secret values in virsh</a></p></li>
</ul>
</div>
<div class="section" id="secret-xml">
<h1><a class="toc-backref" href="#id1">Secret XML</a><a class="headerlink" href="#secret-xml" title="Link to this headline">¶</a></h1>
<p>Secrets stored by libvirt may have attributes associated with them, using the
<span class="docutils literal">secret</span> element. The <span class="docutils literal">secret</span> element has two optional attributes, each
with values '<span class="docutils literal">yes</span>' and '<span class="docutils literal">no</span>', and defaulting to '<span class="docutils literal">no</span>':</p>
<dl class="simple">
<dt><span class="docutils literal">ephemeral</span></dt>
<dd><p>This secret must only be kept in memory, never stored persistently.</p>
</dd>
<dt><span class="docutils literal">private</span></dt>
<dd><p>The value of the secret must not be revealed to any caller of libvirt, nor to
any other node.</p>
</dd>
</dl>
<p>The top-level <span class="docutils literal">secret</span> element may contain the following elements:</p>
<dl class="simple">
<dt><span class="docutils literal">uuid</span></dt>
<dd><p>An unique identifier for this secret (not necessarily in the UUID format). If
omitted when defining a new secret, a random UUID is generated.</p>
</dd>
<dt><span class="docutils literal">description</span></dt>
<dd><p>A human-readable description of the purpose of the secret.</p>
</dd>
<dt><span class="docutils literal">usage</span></dt>
<dd><p>Specifies what this secret is used for. A mandatory <span class="docutils literal">type</span> attribute
specifies the usage category, currently only <span class="docutils literal">volume</span>, <span class="docutils literal">ceph</span>, <span class="docutils literal">iscsi</span>,
<span class="docutils literal">tls</span>, and <span class="docutils literal">vtpm</span> are defined. Specific usage categories are described
below.</p>
</dd>
</dl>
<div class="section" id="usage-type-volume">
<h2><a class="toc-backref" href="#id2">Usage type "volume"</a><a class="headerlink" href="#usage-type-volume" title="Link to this headline">¶</a></h2>
<p>This secret is associated with a volume, whether the format is either for a
"luks" encrypted volume. Each volume will have a unique secret associated with
it and it is safe to delete the secret after the volume is deleted. The
<span class="docutils literal">&lt;usage <span class="pre">type='volume'&gt;</span></span> element must contain a single <span class="docutils literal">volume</span> element that
specifies the path of the volume this secret is associated with. For example,
create a volume-secret.xml file as follows:</p>
<pre class="literal-block">&lt;secret ephemeral='no' private='yes'&gt;
   &lt;description&gt;Super secret name of my first puppy&lt;/description&gt;
   &lt;uuid&gt;0a81f5b2-8403-7b23-c8d6-21ccc2f80d6f&lt;/uuid&gt;
   &lt;usage type='volume'&gt;
      &lt;volume&gt;/var/lib/libvirt/images/puppyname.img&lt;/volume&gt;
   &lt;/usage&gt;
&lt;/secret&gt;</pre>
<p>Define the secret and set the passphrase as follows:</p>
<pre class="literal-block"># virsh secret-define volume-secret.xml
Secret 0a81f5b2-8403-7b23-c8d6-21ccc2f80d6f created</pre>
<p>See <a class="reference internal" href="#setting-secret-values-in-virsh">Setting secret values in virsh</a> on how to set the value of the secret
using <span class="docutils literal">virsh <span class="pre">secret-set-value</span></span>.</p>
<p>The volume type secret can be supplied either in volume XML during creation of a
<a class="reference external" href="formatstorage.html#storage-volume-xml">storage volume</a> in order to provide
the passphrase to encrypt the volume or in domain XML
<a class="reference external" href="formatdomain.html#hard-drives-floppy-disks-cdroms">disk device</a> in order to provide the
passphrase to decrypt the volume, <span class="since">since 2.1.0</span> . An example follows:</p>
<pre class="literal-block"># cat luks-secret.xml
&lt;secret ephemeral='no' private='yes'&gt;
   &lt;description&gt;LUKS Sample Secret&lt;/description&gt;
   &lt;uuid&gt;f52a81b2-424e-490c-823d-6bd4235bc57&lt;/uuid&gt;
   &lt;usage type='volume'&gt;
      &lt;volume&gt;/var/lib/libvirt/images/luks-sample.img&lt;/volume&gt;
   &lt;/usage&gt;
&lt;/secret&gt;

# virsh secret-define luks-secret.xml
Secret f52a81b2-424e-490c-823d-6bd4235bc57 created</pre>
<p>See <a class="reference internal" href="#setting-secret-values-in-virsh">Setting secret values in virsh</a> on how to set the value of the secret
using <span class="docutils literal">virsh <span class="pre">secret-set-value</span></span>.</p>
<p>The volume type secret can be supplied in domain XML for a luks storage volume
<a class="reference external" href="formatstorageencryption.html">encryption</a> as follows:</p>
<pre class="literal-block">&lt;encryption format='luks'&gt;
  &lt;secret type='passphrase' uuid='f52a81b2-424e-490c-823d-6bd4235bc57'/&gt;
&lt;/encryption&gt;</pre>
</div>
<div class="section" id="usage-type-ceph">
<h2><a class="toc-backref" href="#id3">Usage type "ceph"</a><a class="headerlink" href="#usage-type-ceph" title="Link to this headline">¶</a></h2>
<p>This secret is associated with a Ceph RBD (rados block device). The
<span class="docutils literal">&lt;usage <span class="pre">type='ceph'&gt;</span></span> element must contain a single <span class="docutils literal">name</span> element that
specifies a usage name for the secret. The Ceph secret can then be used by UUID
or by this usage name via the <span class="docutils literal">&lt;auth&gt;</span> element of a <a class="reference external" href="formatdomain.html#hard-drives-floppy-disks-cdroms">disk
device</a> or a <a class="reference external" href="formatstorage.html">storage pool
(rbd)</a>. <span class="since">Since 0.9.7</span> . The following is an
example of the steps to be taken. First create a ceph-secret.xml file:</p>
<pre class="literal-block">&lt;secret ephemeral='no' private='yes'&gt;
   &lt;description&gt;CEPH passphrase example&lt;/description&gt;
   &lt;usage type='ceph'&gt;
      &lt;name&gt;ceph_example&lt;/name&gt;
   &lt;/usage&gt;
&lt;/secret&gt;</pre>
<p>Next, use <span class="docutils literal">virsh <span class="pre">secret-define</span> <span class="pre">ceph-secret.xml</span></span> to define the secret and
<span class="docutils literal">virsh <span class="pre">secret-set-value</span></span> using the generated UUID value and a base64 generated
secret value in order to define the chosen secret pass phrase.</p>
<pre class="literal-block"># virsh secret-define ceph-secret.xml
Secret 1b40a534-8301-45d5-b1aa-11894ebb1735 created
#
# virsh secret-list
 UUID                                 Usage
-----------------------------------------------------------
 1b40a534-8301-45d5-b1aa-11894ebb1735 cephx ceph_example</pre>
<p>See <a class="reference internal" href="#setting-secret-values-in-virsh">Setting secret values in virsh</a> on how to set the value of the secret
using <span class="docutils literal">virsh <span class="pre">secret-set-value</span></span>.</p>
<p>The ceph secret can then be used by UUID or by the usage name via the <span class="docutils literal">&lt;auth&gt;</span>
element in a domain's <a class="reference external" href="formatdomain.html#hard-drives-floppy-disks-cdroms">&lt;disk&gt;</a> element as
follows:</p>
<pre class="literal-block">&lt;auth username='myname'&gt;
  &lt;secret type='ceph' usage='ceph_example'/&gt;
&lt;/auth&gt;</pre>
<p>As well as the <span class="docutils literal">&lt;auth&gt;</span> element in a <a class="reference external" href="formatstorage.html">storage pool
(rbd)</a> <span class="docutils literal">&lt;source&gt;</span> element as follows:</p>
<pre class="literal-block">&lt;auth type='ceph' username='myname'&gt;
  &lt;secret usage='ceph_example'/&gt;
&lt;/auth&gt;</pre>
</div>
<div class="section" id="usage-type-iscsi">
<h2><a class="toc-backref" href="#id4">Usage type "iscsi"</a><a class="headerlink" href="#usage-type-iscsi" title="Link to this headline">¶</a></h2>
<p>This secret is associated with an iSCSI target for CHAP authentication. The
<span class="docutils literal">&lt;usage <span class="pre">type='iscsi'&gt;</span></span> element must contain a single <span class="docutils literal">target</span> element that
specifies a usage name for the secret. The iSCSI secret can then be used by UUID
or by this usage name via the <span class="docutils literal">&lt;auth&gt;</span> element of a <a class="reference external" href="formatdomain.html#hard-drives-floppy-disks-cdroms">disk
device</a> or a <a class="reference external" href="formatstorage.html">storage pool
(iscsi)</a>. <span class="since">Since 1.0.4</span> . The following is an
example of the XML that may be used to generate a secret for iSCSI CHAP
authentication. Assume the following sample entry in an iSCSI authentication
file:</p>
<pre class="literal-block">&lt;target iqn.2013-07.com.example:iscsi-pool&gt;
backing-store /home/tgtd/iscsi-pool/disk1
backing-store /home/tgtd/iscsi-pool/disk2
incominguser myname mysecret
&lt;/target&gt;</pre>
<p>Define an iscsi-secret.xml file to describe the secret. Use the <span class="docutils literal">incominguser</span>
username used in your iSCSI authentication configuration file as the value for
the <span class="docutils literal">username</span> attribute. The <span class="docutils literal">description</span> attribute should contain
configuration specific data. The <span class="docutils literal">target</span> name may be any name of your
choosing to be used as the <span class="docutils literal">usage</span> when used in the pool or disk XML
description.</p>
<pre class="literal-block">&lt;secret ephemeral='no' private='yes'&gt;
   &lt;description&gt;Passphrase for the iSCSI example.com server&lt;/description&gt;
   &lt;usage type='iscsi'&gt;
      &lt;target&gt;libvirtiscsi&lt;/target&gt;
   &lt;/usage&gt;
&lt;/secret&gt;</pre>
<p>Next, use <span class="docutils literal">virsh <span class="pre">secret-define</span> <span class="pre">iscsi-secret.xml</span></span> to define the secret and
<span class="docutils literal">virsh <span class="pre">secret-set-value</span></span> using the generated UUID value and a base64 generated
secret value in order to define the chosen secret pass phrase. The pass phrase
must match the password used in the iSCSI authentication configuration file.</p>
<pre class="literal-block"># virsh secret-define secret.xml
Secret c4dbe20b-b1a3-4ac1-b6e6-2ac97852ebb6 created

# virsh secret-list
 UUID                                 Usage
-----------------------------------------------------------
 c4dbe20b-b1a3-4ac1-b6e6-2ac97852ebb6 iscsi libvirtiscsi</pre>
<p>See <a class="reference internal" href="#setting-secret-values-in-virsh">Setting secret values in virsh</a> on how to set the value of the secret
using <span class="docutils literal">virsh <span class="pre">secret-set-value</span></span>.</p>
<p>The iSCSI secret can then be used by UUID or by the usage name via the
<span class="docutils literal">&lt;auth&gt;</span> element in a domain's <a class="reference external" href="formatdomain.html#hard-drives-floppy-disks-cdroms">&lt;disk&gt;</a>
element as follows:</p>
<pre class="literal-block">&lt;auth username='myname'&gt;
  &lt;secret type='iscsi' usage='libvirtiscsi'/&gt;
&lt;/auth&gt;</pre>
<p>As well as the <span class="docutils literal">&lt;auth&gt;</span> element in a <a class="reference external" href="formatstorage.html">storage pool
(iscsi)</a> <span class="docutils literal">&lt;source&gt;</span> element as follows:</p>
<pre class="literal-block">&lt;auth type='chap' username='myname'&gt;
  &lt;secret usage='libvirtiscsi'/&gt;
&lt;/auth&gt;</pre>
</div>
<div class="section" id="usage-type-tls">
<h2><a class="toc-backref" href="#id5">Usage type "tls"</a><a class="headerlink" href="#usage-type-tls" title="Link to this headline">¶</a></h2>
<p>This secret may be used in order to provide the passphrase for the private key
used to provide TLS credentials. The <span class="docutils literal">&lt;usage <span class="pre">type='tls'&gt;</span></span> element must contain
a single <span class="docutils literal">name</span> element that specifies a usage name for the secret.
<span class="since">Since 2.3.0</span> . The following is an example of the expected XML and
processing to define the secret:</p>
<pre class="literal-block"># cat tls-secret.xml
&lt;secret ephemeral='no' private='yes'&gt;
   &lt;description&gt;sample tls secret&lt;/description&gt;
   &lt;usage type='tls'&gt;
      &lt;name&gt;TLS_example&lt;/name&gt;
   &lt;/usage&gt;
&lt;/secret&gt;

# virsh secret-define tls-secret.xml
Secret 718c71bd-67b5-4a2b-87ec-a24e8ca200dc created

# virsh secret-list
 UUID                                 Usage
-----------------------------------------------------------
 718c71bd-67b5-4a2b-87ec-a24e8ca200dc  tls TLS_example</pre>
<p>A secret may also be defined via the
<a class="reference external" href="html/libvirt-libvirt-secret.html#virSecretDefineXML">virSecretDefineXML</a>
API. Once the secret is defined, a secret value will need to be set. The secret
would be the passphrase used to access the TLS credentials. The following is a
simple example of using <span class="docutils literal">virsh <span class="pre">secret-set-value</span></span> to set the secret value. The
<a class="reference external" href="html/libvirt-libvirt-secret.html#virSecretSetValue">virSecretSetValue</a> API
may also be used to set a more secure secret without using printable/readable
characters.</p>
</div>
<div class="section" id="usage-type-vtpm">
<h2><a class="toc-backref" href="#id6">Usage type "vtpm"</a><a class="headerlink" href="#usage-type-vtpm" title="Link to this headline">¶</a></h2>
<p>This secret is associated with a virtualized TPM (vTPM) and serves as a
passphrase for deriving a key from for encrypting the state of the vTPM. The
<span class="docutils literal">&lt;usage <span class="pre">type='vtpm'&gt;</span></span> element must contain a single <span class="docutils literal">name</span> element that
specifies a usage name for the secret. The vTPM secret can then be used by UUID
via the <span class="docutils literal">&lt;encryption&gt;</span> element of a <a class="reference external" href="formatdomain.html#tpm-device">tpm</a>
when using an emulator. <span class="since">Since 5.6.0</span> . The following is an example of
the steps to be taken. First create a vtpm-secret.xml file:</p>
<pre class="literal-block"># cat vtpm-secret.xml
&lt;secret ephemeral='no' private='yes'&gt;
   &lt;description&gt;sample vTPM secret&lt;/description&gt;
   &lt;usage type='vtpm'&gt;
      &lt;name&gt;VTPM_example&lt;/name&gt;
   &lt;/usage&gt;
&lt;/secret&gt;

# virsh secret-define vtpm-secret.xml
Secret 6dd3e4a5-1d76-44ce-961f-f119f5aad935 created

# virsh secret-list
 UUID                                   Usage
----------------------------------------------------------------------------------------
 6dd3e4a5-1d76-44ce-961f-f119f5aad935   vtpm VTPM_example</pre>
<p>A secret may also be defined via the
<a class="reference external" href="html/libvirt-libvirt-secret.html#virSecretDefineXML">virSecretDefineXML</a>
API. Once the secret is defined, a secret value will need to be set. The secret
would be the passphrase used to decrypt the vTPM state. The following is a
simple example of using <span class="docutils literal">virsh <span class="pre">secret-set-value</span></span> to set the secret value. The
<a class="reference external" href="html/libvirt-libvirt-secret.html#virSecretSetValue">virSecretSetValue</a> API
may also be used to set a more secure secret without using printable/readable
characters.</p>
</div>
</div>
<div class="section" id="setting-secret-values-in-virsh">
<h1><a class="toc-backref" href="#id7">Setting secret values in virsh</a><a class="headerlink" href="#setting-secret-values-in-virsh" title="Link to this headline">¶</a></h1>
<p>To set the value of the secret you can use the following virsh commands. If the
secret is a password-like string (printable characters, no newline) you can use:</p>
<pre class="literal-block"># virsh secret-set-value --interactive 6dd3e4a5-1d76-44ce-961f-f119f5aad935
Enter new value for secret:
Secret value set</pre>
<p>Another secure option is to read the secret from a file. This way the secret can
contain any bytes (even NUL and non-printable characters). The length of the
secret is the length of the input file. Alternatively the <span class="docutils literal"><span class="pre">--plain</span></span> option can
be omitted if the file contents are base64-encoded.</p>
<pre class="literal-block"># virsh secret-set-value 6dd3e4a5-1d76-44ce-961f-f119f5aad935 --file --plain secretinfile
Secret value set</pre>
<p><strong>WARNING</strong> The following approach is <strong>insecure</strong> and deprecated. The secret
can also be set via an argument. Note that other users may see the actual secret
in the process listing! The secret must be base64 encoded.</p>
<pre class="literal-block"># MYSECRET=`printf %s "open sesame" | base64`
# virsh secret-set-value 6dd3e4a5-1d76-44ce-961f-f119f5aad935 $MYSECRET
Secret value set</pre>
</div>
</div>
    </div>
    <div id="nav">
      <div id="home">
        <a href="index.html">Home</a>
      </div>
      <div id="jumplinks">
        <ul>
          <li>
            <a href="downloads.html">Download</a>
          </li>
          <li>
            <a href="contribute.html">Contribute</a>
          </li>
          <li>
            <a href="docs.html">Docs</a>
          </li>
        </ul>
      </div>
      <div id="search">
        <form id="simplesearch" action="https://www.google.com/search" enctype="application/x-www-form-urlencoded" method="get">
          <div>
            <input id="searchsite" name="sitesearch" type="hidden" value="libvirt.org"/>
            <input id="searchq" name="q" type="text" size="12" value=""/>
            <input name="submit" type="submit" value="Go"/>
          </div>
        </form>
        <div id="advancedsearch">
          <span>
            <input type="radio" name="what" id="whatwebsite" checked="checked" value="website"/>
            <label for="whatwebsite">Website</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatwiki" value="wiki"/>
            <label for="whatwiki">Wiki</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatdevs" value="devs"/>
            <label for="whatdevs">Developers list</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatusers" value="users"/>
            <label for="whatusers">Users list</label>
          </span>
        </div>
      </div>
    </div>
    <div id="footer">
      <div id="contact">
        <h3>Contact</h3>
        <ul>
          <li>
            <a href="contact.html#mailing-lists">email</a>
          </li>
          <li>
            <a href="contact.html#irc">irc</a>
          </li>
        </ul>
      </div>
      <div id="community">
        <h3>Community</h3>
        <ul>
          <li>
            <a href="https://twitter.com/hashtag/libvirt">twitter</a>
          </li>
          <li>
            <a href="https://stackoverflow.com/questions/tagged/libvirt">stackoverflow</a>
          </li>
          <li>
            <a href="https://serverfault.com/questions/tagged/libvirt">serverfault</a>
          </li>
        </ul>
      </div>
      <div id="contribute">
        <h3>Contribute</h3>
        <ul>
          <li>
            <a href="https://gitlab.com/libvirt/libvirt/-/blob/master/docs/formatsecret.rst">edit this page</a>
          </li>
        </ul>
      </div>
      <div id="conduct">
            Participants in the libvirt project agree to abide by <a href="governance.html#code-of-conduct">the project code of conduct</a></div>
      <br class="clear"/>
    </div>
  </body>
</html>
