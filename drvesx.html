<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <!--
        This file is autogenerated from docs/drvesx.rst
        Do not edit this file. Changes will be lost.
      -->
  <!--
        This page was generated at Wed Apr 19 07:14:27 2023 UTC.
      -->
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" type="text/css" href="css/main.css"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/>
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/>
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/>
    <link rel="manifest" href="/manifest.json"/>
    <meta name="theme-color" content="#ffffff"/>
    <title>libvirt: VMware ESX hypervisor driver</title>
    <meta name="description" content="libvirt, virtualization, virtualization API"/>
    <script type="text/javascript" src="js/main.js">
      <!--// forces non-empty element-->
    </script>
  </head>
  <body onload="pageload()">
    <div id="body">
      <div class="document" id="vmware-esx-hypervisor-driver">
<h1>VMware ESX hypervisor driver</h1>

<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#project-links" id="id1">Project Links</a></p></li>
<li><p><a class="reference internal" href="#deployment-pre-requisites" id="id2">Deployment pre-requisites</a></p></li>
<li><p><a class="reference internal" href="#connections-to-the-vmware-esx-driver" id="id3">Connections to the VMware ESX driver</a></p>
<ul>
<li><p><a class="reference internal" href="#uri-format" id="id4">URI Format</a></p>
<ul>
<li><p><a class="reference internal" href="#extra-parameters" id="id5">Extra parameters</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#authentication" id="id6">Authentication</a></p></li>
<li><p><a class="reference internal" href="#certificates-for-https" id="id7">Certificates for HTTPS</a></p></li>
<li><p><a class="reference internal" href="#connection-problems" id="id8">Connection problems</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#questions-blocking-tasks" id="id9">Questions blocking tasks</a></p></li>
<li><p><a class="reference internal" href="#specialities-in-the-domain-xml-config" id="id10">Specialities in the domain XML config</a></p>
<ul>
<li><p><a class="reference internal" href="#restrictions" id="id11">Restrictions</a></p></li>
<li><p><a class="reference internal" href="#datastore-references" id="id12">Datastore references</a></p></li>
<li><p><a class="reference internal" href="#mac-addresses" id="id13">MAC addresses</a></p></li>
<li><p><a class="reference internal" href="#available-hardware" id="id14">Available hardware</a></p>
<ul>
<li><p><a class="reference internal" href="#scsi-controller-models" id="id15">SCSI controller models</a></p></li>
<li><p><a class="reference internal" href="#network-card-models" id="id16">Network card models</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#import-and-export-of-domain-xml-configs" id="id17">Import and export of domain XML configs</a></p>
<ul>
<li><p><a class="reference internal" href="#converting-from-vmware-vmx-config-to-domain-xml-config" id="id18">Converting from VMware VMX config to domain XML config</a></p></li>
<li><p><a class="reference internal" href="#converting-from-domain-xml-config-to-vmware-vmx-config" id="id19">Converting from domain XML config to VMware VMX config</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#example-domain-xml-configs" id="id20">Example domain XML configs</a></p>
<ul>
<li><p><a class="reference internal" href="#fedora11-on-x86-64" id="id21">Fedora11 on x86_64</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migration" id="id22">Migration</a></p></li>
<li><p><a class="reference internal" href="#scheduler-configuration" id="id23">Scheduler configuration</a></p></li>
<li><p><a class="reference internal" href="#vmware-tools" id="id24">VMware tools</a></p></li>
<li><p><a class="reference internal" href="#links" id="id25">Links</a></p></li>
</ul>
</div>
<p>The libvirt VMware ESX driver can manage VMware ESX/ESXi 3.5/4.x/5.x and VMware
GSX 2.0, also called VMware Server 2.0, and possibly later versions.
<span class="since">Since 0.8.3</span> the driver can also connect to a VMware vCenter 2.5/4.x/5.x
(VPX).</p>
<div class="section" id="project-links">
<h1><a class="toc-backref" href="#id1">Project Links</a><a class="headerlink" href="#project-links" title="Link to this headline">¶</a></h1>
<ul class="simple">
<li><p>The <a class="reference external" href="https://www.vmware.com/">VMware ESX and GSX</a> hypervisors</p></li>
</ul>
</div>
<div class="section" id="deployment-pre-requisites">
<h1><a class="toc-backref" href="#id2">Deployment pre-requisites</a><a class="headerlink" href="#deployment-pre-requisites" title="Link to this headline">¶</a></h1>
<p>None. Any out-of-the-box installation of VPX/ESX(i)/GSX should work. No
preparations are required on the server side, no libvirtd must be installed on
the ESX server. The driver uses version 2.5 of the remote, SOAP based <a class="reference external" href="https://www.vmware.com/support/developer/vc-sdk/visdk25pubs/ReferenceGuide/">VMware
Virtual Infrastructure
API</a>
(VI API) to communicate with the ESX server, like the VMware Virtual
Infrastructure Client (VI client) does. Since version 4.0 this API is called
<a class="reference external" href="https://www.vmware.com/support/developer/vc-sdk/visdk400pubs/ReferenceGuide/">VMware vSphere
API</a>.</p>
</div>
<div class="section" id="connections-to-the-vmware-esx-driver">
<h1><a class="toc-backref" href="#id3">Connections to the VMware ESX driver</a><a class="headerlink" href="#connections-to-the-vmware-esx-driver" title="Link to this headline">¶</a></h1>
<p>Some example remote connection URIs for the driver are:</p>
<pre class="literal-block">vpx://example-vcenter.com/dc1/srv1     (VPX over HTTPS, select ESX server 'srv1' in datacenter 'dc1')
esx://example-esx.com                  (ESX over HTTPS)
gsx://example-gsx.com                  (GSX over HTTPS)
esx://example-esx.com/?transport=http  (ESX over HTTP)
esx://example-esx.com/?no_verify=1     (ESX over HTTPS, but doesn't verify the server's SSL certificate)</pre>
<p><strong>Note</strong>: In contrast to other drivers, the ESX driver is a client-side-only
driver. It connects to the ESX server using HTTP(S). Therefore, the <a class="reference external" href="remote.html">remote
transport mechanism</a> provided by the remote driver and libvirtd
will not work, and you cannot use URIs like <span class="docutils literal"><span class="pre">esx+ssh://example.com</span></span>.</p>
<div class="section" id="uri-format">
<h2><a class="toc-backref" href="#id4">URI Format</a><a class="headerlink" href="#uri-format" title="Link to this headline">¶</a></h2>
<p>URIs have this general form (<span class="docutils literal"><span class="pre">[...]</span></span> marks an optional part).</p>
<pre class="literal-block">type://[username@]hostname[:port]/[[folder/...]datacenter/[folder/...][cluster/]server][?extraparameters]</pre>
<p>The <span class="docutils literal"><span class="pre">type://</span></span> is either <span class="docutils literal"><span class="pre">esx://</span></span> or <span class="docutils literal"><span class="pre">gsx://</span></span> or <span class="docutils literal"><span class="pre">vpx://</span></span> <span class="since">since
0.8.3</span> . The driver selects the default port depending on the <span class="docutils literal"><span class="pre">type://</span></span>. For
<span class="docutils literal"><span class="pre">esx://</span></span> and <span class="docutils literal"><span class="pre">vpx://</span></span> the default HTTPS port is 443, for <span class="docutils literal"><span class="pre">gsx://</span></span> it is
8333. If the port parameter is given, it overrides the default port.</p>
<p>A <span class="docutils literal"><span class="pre">vpx://</span></span> connection is currently restricted to a single ESX server. This
might be relaxed in the future. The path part of the URI is used to specify the
datacenter and the ESX server in it. If the ESX server is part of a cluster then
the cluster has to be specified too.</p>
<p>An example: ESX server <span class="docutils literal"><span class="pre">example-esx.com</span></span> is managed by vCenter
<span class="docutils literal"><span class="pre">example-vcenter.com</span></span> and part of cluster <span class="docutils literal">cluster1</span>. This cluster is part
of datacenter <span class="docutils literal">dc1</span>.</p>
<pre class="literal-block">vpx://example-vcenter.com/dc1/cluster1/example-esx.com</pre>
<p>Datacenters and clusters can be organized in folders, those have to be specified
as well. The driver can handle folders <span class="since">since 0.9.7</span> .</p>
<pre class="literal-block">vpx://example-vcenter.com/folder1/dc1/folder2/example-esx.com</pre>
<div class="section" id="extra-parameters">
<h3><a class="toc-backref" href="#id5">Extra parameters</a><a class="headerlink" href="#extra-parameters" title="Link to this headline">¶</a></h3>
<p>Extra parameters can be added to a URI as part of the query string (the part
following <span class="docutils literal">?</span>). A single parameter is formed by a <span class="docutils literal">name=value</span> pair.
Multiple parameters are separated by <span class="docutils literal">&amp;</span>.</p>
<pre class="literal-block">?no_verify=1&amp;auto_answer=1&amp;proxy=socks://example-proxy.com:23456</pre>
<p>The driver understands the extra parameters shown below.</p>
<table>
<colgroup>
<col style="width: 23%"/>
<col style="width: 39%"/>
<col style="width: 39%"/>
</colgroup>
<thead>
<tr><th class="head"><p>Name</p></th>
<th class="head"><p>Values</p></th>
<th class="head"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr><td><p><span class="docutils literal">transport</span></p></td>
<td><p><span class="docutils literal">http</span> or <span class="docutils literal">https</span></p></td>
<td><p>Overrides the default HTTPS
transport. For <span class="docutils literal"><span class="pre">esx://</span></span>
and <span class="docutils literal"><span class="pre">vpx://</span></span> the default
HTTP port is 80, for
<span class="docutils literal"><span class="pre">gsx://</span></span> it is 8222.</p></td>
</tr>
<tr><td><p><span class="docutils literal">vcenter</span></p></td>
<td><p>Hostname of a VMware
vCenter or <span class="docutils literal">*</span></p></td>
<td><p>In order to perform a
migration the driver needs
to know the VMware vCenter
for the ESX server. If set
to <span class="docutils literal">*</span>, the driver
connects to the vCenter
known to the ESX server.
This parameter in useful
when connecting to an ESX
server only.</p></td>
</tr>
<tr><td><p><span class="docutils literal">no_verify</span></p></td>
<td><p><span class="docutils literal">0</span> or <span class="docutils literal">1</span></p></td>
<td><p>If set to 1, this disables
libcurl client checks of
the server's SSL
certificate. The default
value is 0. See the
<a class="reference internal" href="#certificates-for-https">Certificates for HTTPS</a>
section for details.</p></td>
</tr>
<tr><td><p><span class="docutils literal">auto_answer</span></p></td>
<td><p><span class="docutils literal">0</span> or <span class="docutils literal">1</span></p></td>
<td><p>If set to 1, the driver
answers all
<a class="reference internal" href="#questions-blocking-tasks">Questions blocking tasks</a>
with the default answer. If
set to 0, questions are
reported as errors. The
default value is 0.
<span class="since">Since 0.7.5</span> .</p></td>
</tr>
<tr><td><p><span class="docutils literal">proxy</span></p></td>
<td><p><span class="docutils literal"><span class="pre">[type://]host[:port]</span></span></p></td>
<td><p>Allows to specify a proxy
for HTTP and HTTPS
communication.
<span class="since">Since 0.8.2</span> . The
optional <span class="docutils literal">type</span> part may
be one of: <span class="docutils literal">http</span>,
<span class="docutils literal">socks</span>, <span class="docutils literal">socks4</span>,
<span class="docutils literal">socks4a</span> or <span class="docutils literal">socks5</span>.
The default is <span class="docutils literal">http</span> and
<span class="docutils literal">socks</span> is synonymous for
<span class="docutils literal">socks5</span>. The optional
<span class="docutils literal">port</span> allows to override
the default port 1080.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="authentication">
<h2><a class="toc-backref" href="#id6">Authentication</a><a class="headerlink" href="#authentication" title="Link to this headline">¶</a></h2>
<p>In order to perform any useful operation the driver needs to log into the ESX
server. Therefore, only <span class="docutils literal">virConnectOpenAuth</span> can be used to connect to an ESX
server, <span class="docutils literal">virConnectOpen</span> and <span class="docutils literal">virConnectOpenReadOnly</span> don't work. To log
into an ESX server or vCenter the driver will request credentials using the
callback passed to the <span class="docutils literal">virConnectOpenAuth</span> function. The driver passes the
hostname as challenge parameter to the callback. This enables the callback to
distinguish between requests for ESX server and vCenter.</p>
<p><strong>Note</strong>: During the ongoing driver development, testing is done using an
unrestricted <span class="docutils literal">root</span> account. Problems may occur if you use a restricted
account. Detailed testing with restricted accounts has not been done yet.</p>
</div>
<div class="section" id="certificates-for-https">
<h2><a class="toc-backref" href="#id7">Certificates for HTTPS</a><a class="headerlink" href="#certificates-for-https" title="Link to this headline">¶</a></h2>
<p>By default the ESX driver uses HTTPS to communicate with an ESX server. Proper
HTTPS communication requires correctly configured SSL certificates. This
certificates are different from the ones libvirt uses for <a class="reference external" href="remote.html">secure communication
over TLS</a> to a libvirtd one a remote server.</p>
<p>By default the driver tries to verify the server's SSL certificate using the CA
certificate pool installed on your client computer. With an out-of-the-box
installed ESX server this won't work, because a newly installed ESX server uses
auto-generated self-signed certificates. Those are signed by a CA certificate
that is typically not known to your client computer and libvirt will report an
error like this one:</p>
<pre class="literal-block">error: internal error curl_easy_perform() returned an error: Peer certificate cannot be authenticated with known CA certificates (60)</pre>
<p>Where are two ways to solve this problem:</p>
<ul class="simple">
<li><p>Use the <span class="docutils literal">no_verify=1</span> <a class="reference internal" href="#extra-parameters">Extra parameters</a> to disable server
certificate verification.</p></li>
<li><p>Generate new SSL certificates signed by a CA known to your client computer
and replace the original ones on your ESX server. See the section <em>Replace a
Default Certificate with a CA-Signed Certificate</em> in the <a class="reference external" href="https://www.vmware.com/pdf/vsphere4/r40/vsp_40_esx_server_config.pdf">ESX Configuration
Guide</a></p></li>
</ul>
</div>
<div class="section" id="connection-problems">
<h2><a class="toc-backref" href="#id8">Connection problems</a><a class="headerlink" href="#connection-problems" title="Link to this headline">¶</a></h2>
<p>There are also other causes for connection problems than those related to
<a class="reference internal" href="#certificates-for-https">Certificates for HTTPS</a> .</p>
<ul>
<li><p>As stated before the ESX driver doesn't need the <a class="reference external" href="remote.html">remote transport
mechanism</a> provided by the remote driver and libvirtd, nor
does the ESX driver support it. Therefore, using an URI including a transport
in the scheme won't work. Only URIs as described in <a class="reference internal" href="#uri-format">URI Format</a> are
supported by the ESX driver. Here's a collection of possible error messages:</p>
<pre class="literal-block">$ virsh -c esx+tcp://example.com/
error: unable to connect to libvirtd at 'example.com': Connection refused</pre>
<pre class="literal-block">$ virsh -c esx+tls://example.com/
error: Cannot access CA certificate '/etc/pki/CA/cacert.pem': No such file or directory</pre>
<pre class="literal-block">$ virsh -c esx+ssh://example.com/
error: cannot recv data: ssh: connect to host example.com port 22: Connection refused</pre>
<pre class="literal-block">$ virsh -c esx+ssh://example.com/
error: cannot recv data: Resource temporarily unavailable</pre>
</li>
<li><p><span class="since">Since 0.7.0</span> libvirt contains the ESX driver. Earlier versions of
libvirt will report a misleading error about missing certificates when you
try to connect to an ESX server.</p>
<pre class="literal-block">$ virsh -c esx://example.com/
error: Cannot access CA certificate '/etc/pki/CA/cacert.pem': No such file or directory</pre>
<p>Don't let this error message confuse you. Setting up certificates as
described on the <a class="reference external" href="kbase/tlscerts.html">tls certificates</a> page does not
help, as this is not a certificate related problem.</p>
<p>To fix this problem you need to update your libvirt to 0.7.0 or newer. You
may also see this error when you use a libvirt version that contains the ESX
driver but you or your distro disabled the ESX driver during compilation.
<span class="since">Since 0.8.3</span> the error message has been improved in this case:</p>
<pre class="literal-block">$ virsh -c esx://example.com/
error: invalid argument in libvirt was built without the 'esx' driver</pre>
</li>
</ul>
</div>
</div>
<div class="section" id="questions-blocking-tasks">
<h1><a class="toc-backref" href="#id9">Questions blocking tasks</a><a class="headerlink" href="#questions-blocking-tasks" title="Link to this headline">¶</a></h1>
<p>Some methods of the VI API start tasks, for example <span class="docutils literal">PowerOnVM_Task()</span>. Such
tasks may be blocked by questions if the ESX server detects an issue with the
domain that requires user interaction. The ESX driver cannot prompt the user to
answer a question, libvirt doesn't have an API for something like this.</p>
<p>The VI API provides the <span class="docutils literal">AnswerVM()</span> method to programmatically answer a
questions. So the driver has two options how to handle such a situation: either
answer the questions with the default answer or report the question as an error
and cancel the blocked task if possible. The <span class="docutils literal">auto_answer</span> query
parameter (see <a class="reference internal" href="#uri-format">URI Format</a>) controls the answering behavior.</p>
</div>
<div class="section" id="specialities-in-the-domain-xml-config">
<h1><a class="toc-backref" href="#id10">Specialities in the domain XML config</a><a class="headerlink" href="#specialities-in-the-domain-xml-config" title="Link to this headline">¶</a></h1>
<p>There are several specialities in the domain XML config for ESX domains.</p>
<div class="section" id="restrictions">
<h2><a class="toc-backref" href="#id11">Restrictions</a><a class="headerlink" href="#restrictions" title="Link to this headline">¶</a></h2>
<p>There are some restrictions for some values of the domain XML config. The driver
will complain if this restrictions are violated.</p>
<ul class="simple">
<li><p>Memory size has to be a multiple of 4096</p></li>
<li><p>Number of virtual CPU has to be 1 or a multiple of 2. <span class="since">Since 4.10.0</span>
any number of vCPUs is supported.</p></li>
<li><p>Valid MAC address prefixes are <span class="docutils literal">00:0c:29</span> and <span class="docutils literal">00:50:56</span>. <span class="since">Since
0.7.6</span> arbitrary <a class="reference internal" href="#mac-addresses">MAC addresses</a> are supported.</p></li>
</ul>
</div>
<div class="section" id="datastore-references">
<h2><a class="toc-backref" href="#id12">Datastore references</a><a class="headerlink" href="#datastore-references" title="Link to this headline">¶</a></h2>
<p>Storage is managed in datastores. VMware uses a special path format to reference
files in a datastore. Basically, the datastore name is put into squared braces
in front of the path.</p>
<pre class="literal-block">[datastore] directory/filename</pre>
<p>To define a new domain the driver converts the domain XML into a VMware VMX file
and uploads it to a datastore known to the ESX server. Because multiple
datastores may be known to an ESX server the driver needs to decide to which
datastore the VMX file should be uploaded. The driver deduces this information
from the path of the source of the first file-based harddisk listed in the
domain XML.</p>
</div>
<div class="section" id="mac-addresses">
<h2><a class="toc-backref" href="#id13">MAC addresses</a><a class="headerlink" href="#mac-addresses" title="Link to this headline">¶</a></h2>
<p>VMware has registered two MAC address prefixes for domains: <span class="docutils literal">00:0c:29</span> and
<span class="docutils literal">00:50:56</span>. These prefixes are split into ranges for different purposes.</p>
<table>
<colgroup>
<col style="width: 50%"/>
<col style="width: 50%"/>
</colgroup>
<thead>
<tr><th class="head"><p>Range</p></th>
<th class="head"><p>Purpose</p></th>
</tr>
</thead>
<tbody>
<tr><td><p><span class="docutils literal">00:0c:29:00:00:00</span> -
<span class="docutils literal">00:0c:29:ff:ff:ff</span></p></td>
<td><p>An ESX server autogenerates MAC
addresses from this range if the VMX
file doesn't contain a MAC address
when trying to start a domain.</p></td>
</tr>
<tr><td><p><span class="docutils literal">00:50:56:00:00:00</span> -
<span class="docutils literal">00:50:56:3f:ff:ff</span></p></td>
<td><p>MAC addresses from this range can by
manually assigned by the user in the
VI client.</p></td>
</tr>
<tr><td><p><span class="docutils literal">00:50:56:80:00:00</span> -
<span class="docutils literal">00:50:56:bf:ff:ff</span></p></td>
<td><p>A VI client autogenerates MAC
addresses from this range for newly
defined domains.</p></td>
</tr>
</tbody>
</table>
<p>The VMX files generated by the ESX driver always contain a MAC address, because
libvirt generates a random one if an interface element in the domain XML file
lacks a MAC address. <span class="since">Since 0.7.6</span> the ESX driver sets the prefix for
generated MAC addresses to <span class="docutils literal">00:0c:29</span>. Before 0.7.6 the <span class="docutils literal">00:50:56</span> prefix
was used. Sometimes this resulted in the generation of out-of-range MAC address
that were rejected by the ESX server.</p>
<p>Also <span class="since">since 0.7.6</span> every MAC address outside this ranges can be used. For
such MAC addresses the ESX server-side check is disabled in the VMX file to stop
the ESX server from rejecting out-of-predefined-range MAC addresses.</p>
<pre class="literal-block">ethernet0.checkMACAddress = "false"</pre>
<p><span class="since">Since 6.6.0</span> , one can force libvirt to keep the provided MAC address
when it's in the reserved VMware range by adding a <span class="docutils literal"><span class="pre">type="static"</span></span> attribute
to the <span class="docutils literal">&lt;mac/&gt;</span> element. Note that this attribute is useless if the provided
MAC address is outside of the reserved VMWare ranges.</p>
</div>
<div class="section" id="available-hardware">
<h2><a class="toc-backref" href="#id14">Available hardware</a><a class="headerlink" href="#available-hardware" title="Link to this headline">¶</a></h2>
<p>VMware ESX supports different models of SCSI controllers and network cards.</p>
<div class="section" id="scsi-controller-models">
<h3><a class="toc-backref" href="#id15">SCSI controller models</a><a class="headerlink" href="#scsi-controller-models" title="Link to this headline">¶</a></h3>
<dl class="simple">
<dt><span class="docutils literal">auto</span></dt>
<dd><p>This isn't an actual controller model. If specified the ESX driver tries to
detect the SCSI controller model referenced in the <span class="docutils literal">.vmdk</span> file and use it.
Autodetection fails when a SCSI controller has multiple disks attached and
the SCSI controller models referenced in the <span class="docutils literal">.vmdk</span> files are
inconsistent. <span class="since">Since 0.8.3</span></p>
</dd>
<dt><span class="docutils literal">buslogic</span></dt>
<dd><p>BusLogic SCSI controller for older guests.</p>
</dd>
<dt><span class="docutils literal">lsilogic</span></dt>
<dd><p>LSI Logic SCSI controller for recent guests.</p>
</dd>
<dt><span class="docutils literal">lsisas1068</span></dt>
<dd><p>LSI Logic SAS 1068 controller. <span class="since">Since 0.8.0</span></p>
</dd>
<dt><span class="docutils literal">vmpvscsi</span></dt>
<dd><p>Special VMware Paravirtual SCSI controller, requires VMware tools inside the
guest. See <a class="reference external" href="https://kb.vmware.com/kb/1010398">VMware KB1010398</a> for
details. <span class="since">Since 0.8.3</span></p>
</dd>
</dl>
<p>Here a domain XML snippet:</p>
<pre class="literal-block">...
&lt;disk type='file' device='disk'&gt;
  &lt;source file='[local-storage] Fedora11/Fedora11.vmdk'/&gt;
  &lt;target dev='sda' bus='scsi'/&gt;
  &lt;address type='drive' controller='0' bus='0' unit='0'/&gt;
&lt;/disk&gt;
&lt;controller type='scsi' index='0' model='lsilogic'/&gt;
...</pre>
<p>The controller element is supported <span class="since">since 0.8.2</span> . Prior to this
<span class="docutils literal">&lt;driver <span class="pre">name='lsilogic'/&gt;</span></span> was abused to specify the SCSI controller model.
This attribute usage is deprecated now.</p>
<pre class="literal-block">...
&lt;disk type='file' device='disk'&gt;
  &lt;driver name='lsilogic'/&gt;
  &lt;source file='[local-storage] Fedora11/Fedora11.vmdk'/&gt;
  &lt;target dev='sda' bus='scsi'/&gt;
&lt;/disk&gt;
...</pre>
</div>
<div class="section" id="network-card-models">
<h3><a class="toc-backref" href="#id16">Network card models</a><a class="headerlink" href="#network-card-models" title="Link to this headline">¶</a></h3>
<dl class="simple">
<dt><span class="docutils literal">vlance</span></dt>
<dd><p>AMD PCnet32 network card for older guests.</p>
</dd>
<dt><span class="docutils literal">vmxnet</span>, <span class="docutils literal">vmxnet2</span>, <span class="docutils literal">vmxnet3</span></dt>
<dd><p>Special VMware VMXnet network card, requires VMware tools inside the guest.
See <a class="reference external" href="https://kb.vmware.com/kb/1001805">VMware KB1001805</a> for details.</p>
</dd>
<dt><span class="docutils literal">e1000</span></dt>
<dd><p>Intel E1000 network card for recent guests.</p>
</dd>
</dl>
<p>Here a domain XML snippet:</p>
<pre class="literal-block">...
&lt;interface type='bridge'&gt;
  &lt;mac address='00:50:56:25:48:c7'/&gt;
  &lt;source bridge='VM Network'/&gt;
  &lt;model type='e1000'/&gt;
&lt;/interface&gt;
...</pre>
</div>
</div>
</div>
<div class="section" id="import-and-export-of-domain-xml-configs">
<h1><a class="toc-backref" href="#id17">Import and export of domain XML configs</a><a class="headerlink" href="#import-and-export-of-domain-xml-configs" title="Link to this headline">¶</a></h1>
<p>The ESX driver currently supports a native config format known as <span class="docutils literal"><span class="pre">vmware-vmx</span></span>
to handle VMware VMX configs.</p>
<div class="section" id="converting-from-vmware-vmx-config-to-domain-xml-config">
<h2><a class="toc-backref" href="#id18">Converting from VMware VMX config to domain XML config</a><a class="headerlink" href="#converting-from-vmware-vmx-config-to-domain-xml-config" title="Link to this headline">¶</a></h2>
<p>The <span class="docutils literal">virsh <span class="pre">domxml-from-native</span></span> provides a way to convert an existing VMware
VMX config into a domain XML config that can then be used by libvirt.</p>
<pre class="literal-block">$ cat &gt; demo.vmx &lt;&lt; EOF
#!/usr/bin/vmware
config.version = "8"
virtualHW.version = "4"
floppy0.present = "false"
nvram = "Fedora11.nvram"
deploymentPlatform = "windows"
virtualHW.productCompatibility = "hosted"
tools.upgrade.policy = "useGlobal"
powerType.powerOff = "default"
powerType.powerOn = "default"
powerType.suspend = "default"
powerType.reset = "default"
displayName = "Fedora11"
extendedConfigFile = "Fedora11.vmxf"
scsi0.present = "true"
scsi0.sharedBus = "none"
scsi0.virtualDev = "lsilogic"
memsize = "1024"
scsi0:0.present = "true"
scsi0:0.fileName = "/vmfs/volumes/498076b2-02796c1a-ef5b-000ae484a6a3/Fedora11/Fedora11.vmdk"
scsi0:0.deviceType = "scsi-hardDisk"
ide0:0.present = "true"
ide0:0.clientDevice = "true"
ide0:0.deviceType = "cdrom-raw"
ide0:0.startConnected = "false"
ethernet0.present = "true"
ethernet0.networkName = "VM Network"
ethernet0.addressType = "vpx"
ethernet0.generatedAddress = "00:50:56:91:48:c7"
chipset.onlineStandby = "false"
guestOSAltName = "Red Hat Enterprise Linux 5 (32-Bit)"
guestOS = "rhel5"
uuid.bios = "50 11 5e 16 9b dc 49 d7-f1 71 53 c4 d7 f9 17 10"
snapshot.action = "keep"
sched.cpu.min = "0"
sched.cpu.units = "mhz"
sched.cpu.shares = "normal"
sched.mem.minsize = "0"
sched.mem.shares = "normal"
toolScripts.afterPowerOn = "true"
toolScripts.afterResume = "true"
toolScripts.beforeSuspend = "true"
toolScripts.beforePowerOff = "true"
scsi0:0.redo = ""
tools.syncTime = "false"
uuid.location = "56 4d b5 06 a2 bd fb eb-ae 86 f7 d8 49 27 d0 c4"
sched.cpu.max = "unlimited"
sched.swap.derivedName = "/vmfs/volumes/498076b2-02796c1a-ef5b-000ae484a6a3/Fedora11/Fedora11-7de040d8.vswp"
tools.remindInstall = "TRUE"
EOF

$ virsh -c esx://example.com domxml-from-native vmware-vmx demo.vmx
Enter username for example.com [root]:
Enter root password for example.com:
&lt;domain type='vmware'&gt;
  &lt;name&gt;Fedora11&lt;/name&gt;
  &lt;uuid&gt;50115e16-9bdc-49d7-f171-53c4d7f91710&lt;/uuid&gt;
  &lt;memory&gt;1048576&lt;/memory&gt;
  &lt;currentMemory&gt;1048576&lt;/currentMemory&gt;
  &lt;vcpu&gt;1&lt;/vcpu&gt;
  &lt;os&gt;
    &lt;type arch='i686'&gt;hvm&lt;/type&gt;
  &lt;/os&gt;
  &lt;clock offset='utc'/&gt;
  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
  &lt;on_crash&gt;destroy&lt;/on_crash&gt;
  &lt;devices&gt;
    &lt;disk type='file' device='disk'&gt;
      &lt;source file='[local-storage] Fedora11/Fedora11.vmdk'/&gt;
      &lt;target dev='sda' bus='scsi'/&gt;
      &lt;address type='drive' controller='0' bus='0' unit='0'/&gt;
    &lt;/disk&gt;
    &lt;controller type='scsi' index='0' model='lsilogic'/&gt;
    &lt;interface type='bridge'&gt;
      &lt;mac address='00:50:56:91:48:c7'/&gt;
      &lt;source bridge='VM Network'/&gt;
    &lt;/interface&gt;
  &lt;/devices&gt;
&lt;/domain&gt;</pre>
</div>
<div class="section" id="converting-from-domain-xml-config-to-vmware-vmx-config">
<h2><a class="toc-backref" href="#id19">Converting from domain XML config to VMware VMX config</a><a class="headerlink" href="#converting-from-domain-xml-config-to-vmware-vmx-config" title="Link to this headline">¶</a></h2>
<p>The <span class="docutils literal">virsh <span class="pre">domxml-to-native</span></span> provides a way to convert a domain XML config
into a VMware VMX config.</p>
<pre class="literal-block">$ cat &gt; demo.xml &lt;&lt; EOF
&lt;domain type='vmware'&gt;
  &lt;name&gt;Fedora11&lt;/name&gt;
  &lt;uuid&gt;50115e16-9bdc-49d7-f171-53c4d7f91710&lt;/uuid&gt;
  &lt;memory&gt;1048576&lt;/memory&gt;
  &lt;currentMemory&gt;1048576&lt;/currentMemory&gt;
  &lt;vcpu&gt;1&lt;/vcpu&gt;
  &lt;os&gt;
    &lt;type arch='x86_64'&gt;hvm&lt;/type&gt;
  &lt;/os&gt;
  &lt;devices&gt;
    &lt;disk type='file' device='disk'&gt;
      &lt;source file='[local-storage] Fedora11/Fedora11.vmdk'/&gt;
      &lt;target dev='sda' bus='scsi'/&gt;
      &lt;address type='drive' controller='0' bus='0' unit='0'/&gt;
    &lt;/disk&gt;
    &lt;controller type='scsi' index='0' model='lsilogic'/&gt;
    &lt;interface type='bridge'&gt;
      &lt;mac address='00:50:56:25:48:c7'/&gt;
      &lt;source bridge='VM Network'/&gt;
    &lt;/interface&gt;
  &lt;/devices&gt;
&lt;/domain&gt;
EOF

$ virsh -c esx://example.com domxml-to-native vmware-vmx demo.xml
Enter username for example.com [root]:
Enter root password for example.com:
config.version = "8"
virtualHW.version = "4"
guestOS = "other-64"
uuid.bios = "50 11 5e 16 9b dc 49 d7-f1 71 53 c4 d7 f9 17 10"
displayName = "Fedora11"
memsize = "1024"
numvcpus = "1"
scsi0.present = "true"
scsi0.virtualDev = "lsilogic"
scsi0:0.present = "true"
scsi0:0.deviceType = "scsi-hardDisk"
scsi0:0.fileName = "/vmfs/volumes/local-storage/Fedora11/Fedora11.vmdk"
ethernet0.present = "true"
ethernet0.networkName = "VM Network"
ethernet0.connectionType = "bridged"
ethernet0.addressType = "static"
ethernet0.address = "00:50:56:25:48:C7"</pre>
</div>
</div>
<div class="section" id="example-domain-xml-configs">
<h1><a class="toc-backref" href="#id20">Example domain XML configs</a><a class="headerlink" href="#example-domain-xml-configs" title="Link to this headline">¶</a></h1>
<div class="section" id="fedora11-on-x86-64">
<h2><a class="toc-backref" href="#id21">Fedora11 on x86_64</a><a class="headerlink" href="#fedora11-on-x86-64" title="Link to this headline">¶</a></h2>
<pre class="literal-block">&lt;domain type='vmware'&gt;
  &lt;name&gt;Fedora11&lt;/name&gt;
  &lt;uuid&gt;50115e16-9bdc-49d7-f171-53c4d7f91710&lt;/uuid&gt;
  &lt;memory&gt;1048576&lt;/memory&gt;
  &lt;currentMemory&gt;1048576&lt;/currentMemory&gt;
  &lt;vcpu&gt;1&lt;/vcpu&gt;
  &lt;os&gt;
    &lt;type arch='x86_64'&gt;hvm&lt;/type&gt;
  &lt;/os&gt;
  &lt;devices&gt;
    &lt;disk type='file' device='disk'&gt;
      &lt;source file='[local-storage] Fedora11/Fedora11.vmdk'/&gt;
      &lt;target dev='sda' bus='scsi'/&gt;
      &lt;address type='drive' controller='0' bus='0' unit='0'/&gt;
    &lt;/disk&gt;
    &lt;controller type='scsi' index='0'/&gt;
    &lt;interface type='bridge'&gt;
      &lt;mac address='00:50:56:25:48:c7'/&gt;
      &lt;source bridge='VM Network'/&gt;
    &lt;/interface&gt;
  &lt;/devices&gt;
&lt;/domain&gt;</pre>
</div>
</div>
<div class="section" id="migration">
<h1><a class="toc-backref" href="#id22">Migration</a><a class="headerlink" href="#migration" title="Link to this headline">¶</a></h1>
<p>A migration cannot be initiated on an ESX server directly, a VMware vCenter is
necessary for this. The <span class="docutils literal">vcenter</span> query parameter must be set either to the
hostname or IP address of the vCenter managing the ESX server or to <span class="docutils literal">*</span>.
Setting it to <span class="docutils literal">*</span> causes the driver to connect to the vCenter known to the ESX
server. If the ESX server is not managed by a vCenter an error is reported.</p>
<pre class="literal-block">esx://example.com/?vcenter=example-vcenter.com</pre>
<p>Here's an example how to migrate the domain <span class="docutils literal">Fedora11</span> from ESX server
<span class="docutils literal"><span class="pre">example-src.com</span></span> to ESX server <span class="docutils literal"><span class="pre">example-dst.com</span></span> implicitly involving
vCenter <span class="docutils literal"><span class="pre">example-vcenter.com</span></span> using <span class="docutils literal">virsh</span>.</p>
<pre class="literal-block">$ virsh -c esx://example-src.com/?vcenter=* migrate Fedora11 esx://example-dst.com/?vcenter=*
Enter username for example-src.com [root]:
Enter root password for example-src.com:
Enter username for example-vcenter.com [administrator]:
Enter administrator password for example-vcenter.com:
Enter username for example-dst.com [root]:
Enter root password for example-dst.com:
Enter username for example-vcenter.com [administrator]:
Enter administrator password for example-vcenter.com:</pre>
<p><span class="since">Since 0.8.3</span> you can directly connect to a vCenter. This simplifies
migration a bit. Here's the same migration as above but using <span class="docutils literal"><span class="pre">vpx://</span></span>
connections and assuming both ESX server are in datacenter <span class="docutils literal">dc1</span> and aren't
part of a cluster.</p>
<pre class="literal-block">$ virsh -c vpx://example-vcenter.com/dc1/example-src.com migrate Fedora11 vpx://example-vcenter.com/dc1/example-dst.com
Enter username for example-vcenter.com [administrator]:
Enter administrator password for example-vcenter.com:
Enter username for example-vcenter.com [administrator]:
Enter administrator password for example-vcenter.com:</pre>
</div>
<div class="section" id="scheduler-configuration">
<h1><a class="toc-backref" href="#id23">Scheduler configuration</a><a class="headerlink" href="#scheduler-configuration" title="Link to this headline">¶</a></h1>
<p>The driver exposes the ESX CPU scheduler. The parameters listed below are
available to control the scheduler.</p>
<dl class="simple">
<dt><span class="docutils literal">reservation</span></dt>
<dd><p>The amount of CPU resource in MHz that is guaranteed to be available to the
domain. Valid values are 0 and greater.</p>
</dd>
<dt><span class="docutils literal">limit</span></dt>
<dd><p>The CPU utilization of the domain will be limited to this value in MHz, even
if more CPU resources are available. If the limit is set to -1, the CPU
utilization of the domain is unlimited. If the limit is not set to -1, it
must be greater than or equal to the reservation.</p>
</dd>
<dt><span class="docutils literal">shares</span></dt>
<dd><p>Shares are used to determine relative CPU allocation between domains. In
general, a domain with more shares gets proportionally more of the CPU
resource. Valid values are 0 and greater. The special values -1, -2 and -3
represent the predefined shares level <span class="docutils literal">low</span>, <span class="docutils literal">normal</span> and <span class="docutils literal">high</span>.</p>
</dd>
</dl>
</div>
<div class="section" id="vmware-tools">
<h1><a class="toc-backref" href="#id24">VMware tools</a><a class="headerlink" href="#vmware-tools" title="Link to this headline">¶</a></h1>
<p>Some actions require installed VMware tools. If the VMware tools are not
installed in the guest and one of the actions below is to be performed the ESX
server raises an error and the driver reports it.</p>
<ul class="simple">
<li><p><span class="docutils literal">virDomainGetHostname</span></p></li>
<li><p><span class="docutils literal">virDomainInterfaceAddresses</span> (only for the
<span class="docutils literal">VIR_DOMAIN_INTERFACE_ADDRESSES_SRC_AGENT</span> source)</p></li>
<li><p><span class="docutils literal">virDomainReboot</span></p></li>
<li><p><span class="docutils literal">virDomainShutdown</span></p></li>
</ul>
</div>
<div class="section" id="links">
<h1><a class="toc-backref" href="#id25">Links</a><a class="headerlink" href="#links" title="Link to this headline">¶</a></h1>
<ul class="simple">
<li><p><a class="reference external" href="https://www.vmware.com/support/developer/vc-sdk/">VMware vSphere Web Services SDK
Documentation</a></p></li>
<li><p><a class="reference external" href="https://www.vmware.com/pdf/esx3_memory.pdf">The Role of Memory in VMware ESX Server
3</a></p></li>
<li><p><a class="reference external" href="https://www.sanbarrow.com/vmx.html">VMware VMX config parameters</a></p></li>
<li><p><a class="reference external" href="https://www.vmware.com/pdf/vsp_4_pvscsi_perf.pdf">VMware ESX 4.0 PVSCSI Storage
Performance</a></p></li>
</ul>
</div>
</div>
    </div>
    <div id="nav">
      <div id="home">
        <a href="index.html">Home</a>
      </div>
      <div id="jumplinks">
        <ul>
          <li>
            <a href="downloads.html">Download</a>
          </li>
          <li>
            <a href="contribute.html">Contribute</a>
          </li>
          <li>
            <a href="docs.html">Docs</a>
          </li>
        </ul>
      </div>
      <div id="search">
        <form id="simplesearch" action="https://www.google.com/search" enctype="application/x-www-form-urlencoded" method="get">
          <div>
            <input id="searchsite" name="sitesearch" type="hidden" value="libvirt.org"/>
            <input id="searchq" name="q" type="text" size="12" value=""/>
            <input name="submit" type="submit" value="Go"/>
          </div>
        </form>
        <div id="advancedsearch">
          <span>
            <input type="radio" name="what" id="whatwebsite" checked="checked" value="website"/>
            <label for="whatwebsite">Website</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatwiki" value="wiki"/>
            <label for="whatwiki">Wiki</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatdevs" value="devs"/>
            <label for="whatdevs">Developers list</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatusers" value="users"/>
            <label for="whatusers">Users list</label>
          </span>
        </div>
      </div>
    </div>
    <div id="footer">
      <div id="contact">
        <h3>Contact</h3>
        <ul>
          <li>
            <a href="contact.html#mailing-lists">email</a>
          </li>
          <li>
            <a href="contact.html#irc">irc</a>
          </li>
        </ul>
      </div>
      <div id="community">
        <h3>Community</h3>
        <ul>
          <li>
            <a href="https://twitter.com/hashtag/libvirt">twitter</a>
          </li>
          <li>
            <a href="https://stackoverflow.com/questions/tagged/libvirt">stackoverflow</a>
          </li>
          <li>
            <a href="https://serverfault.com/questions/tagged/libvirt">serverfault</a>
          </li>
        </ul>
      </div>
      <div id="contribute">
        <h3>Contribute</h3>
        <ul>
          <li>
            <a href="https://gitlab.com/libvirt/libvirt/-/blob/master/docs/drvesx.rst">edit this page</a>
          </li>
        </ul>
      </div>
      <div id="conduct">
            Participants in the libvirt project agree to abide by <a href="governance.html#code-of-conduct">the project code of conduct</a></div>
      <br class="clear"/>
    </div>
  </body>
</html>
