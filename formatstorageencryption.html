<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <!--
        This file is autogenerated from docs/formatstorageencryption.rst
        Do not edit this file. Changes will be lost.
      -->
  <!--
        This page was generated at Wed Apr 19 07:14:27 2023 UTC.
      -->
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" type="text/css" href="css/main.css"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/>
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/>
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/>
    <link rel="manifest" href="/manifest.json"/>
    <meta name="theme-color" content="#ffffff"/>
    <title>libvirt: Storage volume encryption XML format</title>
    <meta name="description" content="libvirt, virtualization, virtualization API"/>
    <script type="text/javascript" src="js/main.js">
      <!--// forces non-empty element-->
    </script>
  </head>
  <body onload="pageload()">
    <div id="body">
      <div class="document" id="storage-volume-encryption-xml-format">
<h1>Storage volume encryption XML format</h1>

<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#storage-volume-encryption-xml" id="id1">Storage volume encryption XML</a></p>
<ul>
<li><p><a class="reference internal" href="#qcow-format" id="id2"><span class="docutils literal">qcow</span> format</a></p></li>
<li><p><a class="reference internal" href="#luks-format" id="id3"><span class="docutils literal">luks</span> format</a></p></li>
<li><p><a class="reference internal" href="#luks2-format" id="id4"><span class="docutils literal">luks2</span> format</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#examples" id="id5">Examples</a></p></li>
</ul>
</div>
<div class="section" id="storage-volume-encryption-xml">
<h1><a class="toc-backref" href="#id1">Storage volume encryption XML</a><a class="headerlink" href="#storage-volume-encryption-xml" title="Link to this headline">¶</a></h1>
<p>Storage volumes may be encrypted, the XML snippet described below is used to
represent the details of the encryption. It can be used as a part of a domain or
storage configuration.</p>
<p>The top-level tag of volume encryption specification is <span class="docutils literal">encryption</span>, with a
mandatory attribute <span class="docutils literal">format</span>. Currently defined values of <span class="docutils literal">format</span> are
<span class="docutils literal">default</span>, <span class="docutils literal">qcow</span>, <span class="docutils literal">luks</span>, and <span class="docutils literal">luks2</span>. Each value of <span class="docutils literal">format</span> implies
some expectations about the content of the <span class="docutils literal">encryption</span> tag. Other format
values may be defined in the future.</p>
<p>The <span class="docutils literal">encryption</span> tag supports an optional <span class="docutils literal">engine</span> tag, which allows
selecting which component actually handles the encryption. Currently defined
values of <span class="docutils literal">engine</span> are <span class="docutils literal">qemu</span> and <span class="docutils literal">librbd</span>. Both <span class="docutils literal">qemu</span> and <span class="docutils literal">librbd</span>
require using the qemu driver. The <span class="docutils literal">librbd</span> engine requires qemu version &gt;=
6.1.0, both ceph cluster and librbd1 &gt;= 16.1.0, and is only applicable for RBD
network disks. If the engine tag is not specified, the <span class="docutils literal">qemu</span> engine will be
used by default (assuming the qemu driver is used). Note that <span class="docutils literal">librbd</span> engine
is currently only supported by the qemu VM driver, and is not supported by the
storage driver. Furthermore, the storage driver currently ignores the <span class="docutils literal">engine</span>
tag.</p>
<p>The <span class="docutils literal">encryption</span> tag can currently contain a sequence of <span class="docutils literal">secret</span> tags, each
with mandatory attributes <span class="docutils literal">type</span> and either <span class="docutils literal">uuid</span> or <span class="docutils literal">usage</span> (
<span class="since">since 2.1.0</span> ). The only currently defined value of <span class="docutils literal">type</span> is
<span class="docutils literal">volume</span>. The <span class="docutils literal">uuid</span> is "uuid" of the <span class="docutils literal">secret</span> while <span class="docutils literal">usage</span> is the
"usage" subelement field. A secret value can be set in libvirt by the
<a class="reference external" href="html/libvirt-libvirt-secret.html#virSecretSetValue">virSecretSetValue</a> API.
Alternatively, if supported by the particular volume format and driver,
automatically generate a secret value at the time of volume creation, and store
it using the specified <span class="docutils literal">uuid</span>.</p>
<div class="section" id="qcow-format">
<h2><a class="toc-backref" href="#id2"><span class="docutils literal">qcow</span> format</a><a class="headerlink" href="#qcow-format" title="Link to this headline">¶</a></h2>
<p><span class="since">Since 4.5.0,</span> encryption formats <span class="docutils literal">default</span> and <span class="docutils literal">qcow</span> may no longer
be used to create an encrypted volume. Usage of qcow encrypted volumes in QEMU
began phasing out in QEMU 2.3 and by QEMU 2.9 creation of a qcow encrypted
volume via qemu-img required usage of secret objects, but that support was not
added to libvirt.</p>
</div>
<div class="section" id="luks-format">
<h2><a class="toc-backref" href="#id3"><span class="docutils literal">luks</span> format</a><a class="headerlink" href="#luks-format" title="Link to this headline">¶</a></h2>
<p>The <span class="docutils literal">luks</span> format is specific to a luks encrypted volume and the secret is
used in order to either encrypt during volume creation or decrypt the volume for
usage by the domain. A single <span class="docutils literal">&lt;secret <span class="pre">type='passphrase'...&gt;</span></span> element is
expected. <span class="since">Since 2.1.0</span> .</p>
<p>For volume creation, it is possible to specify the encryption algorithm used to
encrypt the luks volume. The following two optional elements may be provided for
that purpose. It is hypervisor dependent as to which algorithms are supported.
The default algorithm used by the storage driver backend when using qemu-img to
create the volume is 'aes-256-cbc' using 'essiv' for initialization vector
generation and 'sha256' hash algorithm for both the cipher and the
initialization vector generation.</p>
<dl>
<dt><span class="docutils literal">cipher</span></dt>
<dd><p>This element describes the cipher algorithm to be used to either encrypt or
decrypt the luks volume. This element has the following attributes:</p>
<dl class="simple">
<dt><span class="docutils literal">name</span></dt>
<dd><p>The name of the cipher algorithm used for data encryption, such as 'aes',
'des', 'cast5', 'serpent', 'twofish', etc. Support of the specific
algorithm is storage driver implementation dependent.</p>
</dd>
<dt><span class="docutils literal">size</span></dt>
<dd><p>The size of the cipher in bits, such as '256', '192', '128', etc. Support
of the specific size for a specific cipher is hypervisor dependent.</p>
</dd>
<dt><span class="docutils literal">mode</span></dt>
<dd><p>An optional cipher algorithm mode such as 'cbc', 'xts', 'ecb', etc.
Support of the specific cipher mode is hypervisor dependent.</p>
</dd>
<dt><span class="docutils literal">hash</span></dt>
<dd><p>An optional master key hash algorithm such as 'md5', 'sha1', 'sha256',
etc. Support of the specific hash algorithm is hypervisor dependent.</p>
</dd>
</dl>
</dd>
<dt><span class="docutils literal">ivgen</span></dt>
<dd><p>This optional element describes the initialization vector generation
algorithm used in conjunction with the <span class="docutils literal">cipher</span>. If the <span class="docutils literal">cipher</span> is not
provided, then an error will be generated by the parser.</p>
<dl class="simple">
<dt><span class="docutils literal">name</span></dt>
<dd><p>The name of the algorithm, such as 'plain', 'plain64', 'essiv', etc.
Support of the specific algorithm is hypervisor dependent.</p>
</dd>
<dt><span class="docutils literal">hash</span></dt>
<dd><p>An optional hash algorithm such as 'md5', 'sha1', 'sha256', etc. Support
of the specific ivgen hash algorithm is hypervisor dependent.</p>
</dd>
</dl>
</dd>
</dl>
</div>
<div class="section" id="luks2-format">
<h2><a class="toc-backref" href="#id4"><span class="docutils literal">luks2</span> format</a><a class="headerlink" href="#luks2-format" title="Link to this headline">¶</a></h2>
<p>The <span class="docutils literal">luks2</span> format is currently supported only by the <span class="docutils literal">librbd</span> engine, and
can only be applied to RBD network disks (RBD images). Since the <span class="docutils literal">librbd</span>
engine is currently not supported by the libvirt storage driver, you cannot use
it to control such disks. However, pre-formatted RBD luks2 disks can be loaded
to a qemu VM using the qemu VM driver. A single
<span class="docutils literal">&lt;secret <span class="pre">type='passphrase'...&gt;</span></span> element is expected.</p>
</div>
</div>
<div class="section" id="examples">
<h1><a class="toc-backref" href="#id5">Examples</a><a class="headerlink" href="#examples" title="Link to this headline">¶</a></h1>
<p>Assuming a <a class="reference external" href="formatsecret.html#usage-type-volume">luks volume type secret</a> is
already defined, a simple example specifying use of the <span class="docutils literal">luks</span> format for
either volume creation without a specific cipher being defined or as part of a
domain volume definition:</p>
<pre class="literal-block">&lt;encryption format='luks'&gt;
  &lt;secret type='passphrase' uuid='f52a81b2-424e-490c-823d-6bd4235bc572'/&gt;
&lt;/encryption&gt;</pre>
<p>Here is an example specifying use of the <span class="docutils literal">luks</span> format for a specific cipher
algorithm for volume creation. <span class="since">Since 6.10.0,</span> the <span class="docutils literal">target</span> format can
also support <span class="docutils literal">qcow2</span> type with <span class="docutils literal">luks</span> encryption.</p>
<pre class="literal-block">&lt;volume&gt;
  &lt;name&gt;twofish.luks&lt;/name&gt;
  &lt;capacity unit='G'&gt;5&lt;/capacity&gt;
  &lt;target&gt;
    &lt;path&gt;/var/lib/libvirt/images/demo.luks&lt;/path&gt;
    &lt;format type='raw'/&gt;
    &lt;encryption format='luks'&gt;
       &lt;secret type='passphrase' uuid='f52a81b2-424e-490c-823d-6bd4235bc572'/&gt;
       &lt;cipher name='twofish' size='256' mode='cbc' hash='sha256'/&gt;
       &lt;ivgen name='plain64' hash='sha256'/&gt;
    &lt;/encryption&gt;
  &lt;/target&gt;
&lt;/volume&gt;</pre>
</div>
</div>
    </div>
    <div id="nav">
      <div id="home">
        <a href="index.html">Home</a>
      </div>
      <div id="jumplinks">
        <ul>
          <li>
            <a href="downloads.html">Download</a>
          </li>
          <li>
            <a href="contribute.html">Contribute</a>
          </li>
          <li>
            <a href="docs.html">Docs</a>
          </li>
        </ul>
      </div>
      <div id="search">
        <form id="simplesearch" action="https://www.google.com/search" enctype="application/x-www-form-urlencoded" method="get">
          <div>
            <input id="searchsite" name="sitesearch" type="hidden" value="libvirt.org"/>
            <input id="searchq" name="q" type="text" size="12" value=""/>
            <input name="submit" type="submit" value="Go"/>
          </div>
        </form>
        <div id="advancedsearch">
          <span>
            <input type="radio" name="what" id="whatwebsite" checked="checked" value="website"/>
            <label for="whatwebsite">Website</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatwiki" value="wiki"/>
            <label for="whatwiki">Wiki</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatdevs" value="devs"/>
            <label for="whatdevs">Developers list</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatusers" value="users"/>
            <label for="whatusers">Users list</label>
          </span>
        </div>
      </div>
    </div>
    <div id="footer">
      <div id="contact">
        <h3>Contact</h3>
        <ul>
          <li>
            <a href="contact.html#mailing-lists">email</a>
          </li>
          <li>
            <a href="contact.html#irc">irc</a>
          </li>
        </ul>
      </div>
      <div id="community">
        <h3>Community</h3>
        <ul>
          <li>
            <a href="https://twitter.com/hashtag/libvirt">twitter</a>
          </li>
          <li>
            <a href="https://stackoverflow.com/questions/tagged/libvirt">stackoverflow</a>
          </li>
          <li>
            <a href="https://serverfault.com/questions/tagged/libvirt">serverfault</a>
          </li>
        </ul>
      </div>
      <div id="contribute">
        <h3>Contribute</h3>
        <ul>
          <li>
            <a href="https://gitlab.com/libvirt/libvirt/-/blob/master/docs/formatstorageencryption.rst">edit this page</a>
          </li>
        </ul>
      </div>
      <div id="conduct">
            Participants in the libvirt project agree to abide by <a href="governance.html#code-of-conduct">the project code of conduct</a></div>
      <br class="clear"/>
    </div>
  </body>
</html>
