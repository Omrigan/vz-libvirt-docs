<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <!--
        This file is autogenerated from docs/formatcheckpoint.rst
        Do not edit this file. Changes will be lost.
      -->
  <!--
        This page was generated at Wed Apr 19 07:14:27 2023 UTC.
      -->
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" type="text/css" href="css/main.css"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/>
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/>
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/>
    <link rel="manifest" href="/manifest.json"/>
    <meta name="theme-color" content="#ffffff"/>
    <title>libvirt: Checkpoint XML format</title>
    <meta name="description" content="libvirt, virtualization, virtualization API"/>
    <script type="text/javascript" src="js/main.js">
      <!--// forces non-empty element-->
    </script>
  </head>
  <body onload="pageload()">
    <div id="body">
      <div class="document" id="checkpoint-xml-format">
<h1>Checkpoint XML format</h1>

<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#checkpoint-xml" id="id1">Checkpoint XML</a></p></li>
<li><p><a class="reference internal" href="#examples" id="id2">Examples</a></p></li>
</ul>
</div>
<div class="section" id="checkpoint-xml">
<h1><a class="toc-backref" href="#id1">Checkpoint XML</a><a class="headerlink" href="#checkpoint-xml" title="Link to this headline">¶</a></h1>
<p>One method of capturing domain disk backups is via the use of incremental
backups. Right now, incremental backups are only supported for the QEMU
hypervisor when using qcow2 disks at the active layer; if other disk formats are
in use, capturing disk backups requires different libvirt APIs (see <a class="reference external" href="kbase/domainstatecapture.html">domain
state capture</a> for a comparison between APIs).</p>
<p>Libvirt is able to facilitate incremental backups by tracking disk checkpoints,
which are points in time against which it is easy to compute which portion of
the disk has changed. Given a full backup (a backup created from the creation of
the disk to a given point in time), coupled with the creation of a disk
checkpoint at that time, and an incremental backup (a backup created from just
the dirty portion of the disk between the first checkpoint and the second backup
operation), it is possible to do an offline reconstruction of the state of the
disk at the time of the second backup without having to copy as much data as a
second full backup would require. Most disk checkpoints are created in
conjunction with a backup via <span class="docutils literal">virDomainBackupBegin()</span>, although a future API
addition of <span class="docutils literal">virDomainSnapshotCreateXML2()</span> will also make this possible when
creating external snapshots; however, libvirt also exposes enough support to
create disk checkpoints independently from a backup operation via
<span class="docutils literal">virDomainCheckpointCreateXML()</span> since 5.6.0. Likewise, the creation of
checkpoints when external snapshots exist is currently forbidden, although
future work will make it possible to integrate these two concepts.</p>
<p>Attributes of libvirt checkpoints are stored as child elements of the
<span class="docutils literal">domaincheckpoint</span> element. At checkpoint creation time, normally only the
<span class="docutils literal">name</span>, <span class="docutils literal">description</span>, and <span class="docutils literal">disks</span> elements are settable. The rest of the
fields are ignored on creation and will be filled in by libvirt in for
informational purposes by <span class="docutils literal">virDomainCheckpointGetXMLDesc()</span>. However, when
redefining a checkpoint, with the <span class="docutils literal">VIR_DOMAIN_CHECKPOINT_CREATE_REDEFINE</span> flag
of <span class="docutils literal">virDomainCheckpointCreateXML()</span>, all of the XML fields described here are
relevant on input, even the fields that are normally described as readonly for
output.</p>
<p>The top-level <span class="docutils literal">domaincheckpoint</span> element may contain the following elements:</p>
<dl>
<dt><span class="docutils literal">name</span></dt>
<dd><p>The optional name for this checkpoint. If the name is omitted, libvirt will
create a name based on the time of the creation.</p>
</dd>
<dt><span class="docutils literal">description</span></dt>
<dd><p>An optional human-readable description of the checkpoint. If the description
is omitted when initially creating the checkpoint, then this field will be
empty.</p>
</dd>
<dt><span class="docutils literal">disks</span></dt>
<dd><p>On input, this is an optional listing of specific instructions for disk
checkpoints; it is needed when making a checkpoint on only a subset of the
disks associated with a domain. In particular, since QEMU checkpoints require
qcow2 disks, this element may be needed on input for excluding guest disks
that are not in qcow2 format. If the entire element was omitted on input,
then all disks participate in the checkpoint, otherwise, only the disks
explicitly listed which do not also use <span class="docutils literal"><span class="pre">checkpoint='no'</span></span> will participate.
On output, this is the checkpoint state of each of the domain's disks.</p>
<dl>
<dt><span class="docutils literal">disk</span></dt>
<dd><p>This sub-element describes the checkpoint properties of a specific disk
with the following attributes:</p>
<dl>
<dt><span class="docutils literal">name</span></dt>
<dd><p>A mandatory attribute which must match either the
<span class="docutils literal">&lt;target <span class="pre">dev='name'/&gt;</span></span> or an unambiguous <span class="docutils literal">&lt;source <span class="pre">file='name'/&gt;</span></span> of
one of the <a class="reference external" href="formatdomain.html#hard-drives-floppy-disks-cdroms">disk devices</a> specified
for the domain at the time of the checkpoint.</p>
</dd>
<dt><span class="docutils literal">checkpoint</span></dt>
<dd><p>An optional attribute; possible values are <span class="docutils literal">no</span> when the disk does
not participate in this checkpoint; or <span class="docutils literal">bitmap</span> if the disk will
track all changes since the creation of this checkpoint via a bitmap.</p>
</dd>
<dt><span class="docutils literal">bitmap</span></dt>
<dd><p>The attribute <span class="docutils literal">bitmap</span> is only valid if <span class="docutils literal"><span class="pre">checkpoint='bitmap'</span></span>; it
describes the name of the tracking bitmap (defaulting to the checkpoint
name).</p>
</dd>
<dt><span class="docutils literal">size</span></dt>
<dd><p>The attribute <span class="docutils literal">size</span> is ignored on input; on output, it is only
present if the <span class="docutils literal">VIR_DOMAIN_CHECKPOINT_XML_SIZE</span> flag was used to
perform a dynamic query of the estimated size in bytes of the changes
made since the checkpoint was created.</p>
<p>Note that updating the backup <span class="docutils literal">size</span> may be expensive and
the actual required size may increase if the guest OS is actively
writing to the disk.</p>
</dd>
</dl>
</dd>
</dl>
</dd>
<dt><span class="docutils literal">creationTime</span></dt>
<dd><p>A readonly representation of the time this checkpoint was created. The time
is specified in seconds since the Epoch, UTC (i.e. Unix time).</p>
</dd>
<dt><span class="docutils literal">parent</span></dt>
<dd><p>Readonly, present if this checkpoint has a parent. The parent name is given
by the sub-element <span class="docutils literal">name</span>. The parent relationship allows tracking a list
of related checkpoints.</p>
</dd>
<dt><span class="docutils literal">domain</span></dt>
<dd><p>A readonly representation of the inactive <a class="reference external" href="formatdomain.html">domain
configuration</a> at the time the checkpoint was created.
This element may be omitted for output brevity by supplying the
<span class="docutils literal">VIR_DOMAIN_CHECKPOINT_XML_NO_DOMAIN</span> flag. The domain will have
security-sensitive information omitted unless the flag
<span class="docutils literal">VIR_DOMAIN_CHECKPOINT_XML_SECURE</span> is provided on a read-write connection.</p>
<p><span class="docutils literal">virDomainCheckpointCreateXML()</span> requires that the <span class="docutils literal">&lt;domain&gt;</span> is present
when used with <span class="docutils literal">VIR_DOMAIN_CHECKPOINT_CREATE_REDEFINE</span>.
<span class="since">Since 7.0.0</span> the <span class="docutils literal">&lt;domain&gt;</span> element can be omitted when redefining
a checkpoint, but hypervisors may not support certain operations if it's
missing.</p>
</dd>
</dl>
</div>
<div class="section" id="examples">
<h1><a class="toc-backref" href="#id2">Examples</a><a class="headerlink" href="#examples" title="Link to this headline">¶</a></h1>
<p>Using this XML to create a checkpoint of just vda on a qemu domain with two
disks and a prior checkpoint:</p>
<pre class="literal-block">&lt;domaincheckpoint&gt;
  &lt;description&gt;Completion of updates after OS install&lt;/description&gt;
  &lt;disks&gt;
    &lt;disk name='vda' checkpoint='bitmap'/&gt;
    &lt;disk name='vdb' checkpoint='no'/&gt;
  &lt;/disks&gt;
&lt;/domaincheckpoint&gt;</pre>
<p>will result in XML similar to this from <span class="docutils literal">virDomainCheckpointGetXMLDesc()</span>:</p>
<pre class="literal-block">&lt;domaincheckpoint&gt;
  &lt;name&gt;1525889631&lt;/name&gt;
  &lt;description&gt;Completion of updates after OS install&lt;/description&gt;
  &lt;parent&gt;
    &lt;name&gt;1525111885&lt;/name&gt;
  &lt;/parent&gt;
  &lt;creationTime&gt;1525889631&lt;/creationTime&gt;
  &lt;disks&gt;
    &lt;disk name='vda' checkpoint='bitmap' bitmap='1525889631'/&gt;
    &lt;disk name='vdb' checkpoint='no'/&gt;
  &lt;/disks&gt;
  &lt;domain type='qemu'&gt;
    &lt;name&gt;fedora&lt;/name&gt;
    &lt;uuid&gt;93a5c045-6457-2c09-e56c-927cdf34e178&lt;/uuid&gt;
    &lt;memory&gt;1048576&lt;/memory&gt;
    ...
    &lt;devices&gt;
      &lt;disk type='file' device='disk'&gt;
        &lt;driver name='qemu' type='qcow2'/&gt;
        &lt;source file='/path/to/file1'/&gt;
        &lt;target dev='vda' bus='virtio'/&gt;
      &lt;/disk&gt;
      &lt;disk type='file' device='disk' snapshot='external'&gt;
        &lt;driver name='qemu' type='raw'/&gt;
        &lt;source file='/path/to/file2'/&gt;
        &lt;target dev='vdb' bus='virtio'/&gt;
      &lt;/disk&gt;
      ...
    &lt;/devices&gt;
  &lt;/domain&gt;
&lt;/domaincheckpoint&gt;</pre>
<p>With that checkpoint created, the qcow2 image is now tracking all changes that
occur in the image since the checkpoint via the persistent bitmap named
<span class="docutils literal">1525889631</span>.</p>
</div>
</div>
    </div>
    <div id="nav">
      <div id="home">
        <a href="index.html">Home</a>
      </div>
      <div id="jumplinks">
        <ul>
          <li>
            <a href="downloads.html">Download</a>
          </li>
          <li>
            <a href="contribute.html">Contribute</a>
          </li>
          <li>
            <a href="docs.html">Docs</a>
          </li>
        </ul>
      </div>
      <div id="search">
        <form id="simplesearch" action="https://www.google.com/search" enctype="application/x-www-form-urlencoded" method="get">
          <div>
            <input id="searchsite" name="sitesearch" type="hidden" value="libvirt.org"/>
            <input id="searchq" name="q" type="text" size="12" value=""/>
            <input name="submit" type="submit" value="Go"/>
          </div>
        </form>
        <div id="advancedsearch">
          <span>
            <input type="radio" name="what" id="whatwebsite" checked="checked" value="website"/>
            <label for="whatwebsite">Website</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatwiki" value="wiki"/>
            <label for="whatwiki">Wiki</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatdevs" value="devs"/>
            <label for="whatdevs">Developers list</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatusers" value="users"/>
            <label for="whatusers">Users list</label>
          </span>
        </div>
      </div>
    </div>
    <div id="footer">
      <div id="contact">
        <h3>Contact</h3>
        <ul>
          <li>
            <a href="contact.html#mailing-lists">email</a>
          </li>
          <li>
            <a href="contact.html#irc">irc</a>
          </li>
        </ul>
      </div>
      <div id="community">
        <h3>Community</h3>
        <ul>
          <li>
            <a href="https://twitter.com/hashtag/libvirt">twitter</a>
          </li>
          <li>
            <a href="https://stackoverflow.com/questions/tagged/libvirt">stackoverflow</a>
          </li>
          <li>
            <a href="https://serverfault.com/questions/tagged/libvirt">serverfault</a>
          </li>
        </ul>
      </div>
      <div id="contribute">
        <h3>Contribute</h3>
        <ul>
          <li>
            <a href="https://gitlab.com/libvirt/libvirt/-/blob/master/docs/formatcheckpoint.rst">edit this page</a>
          </li>
        </ul>
      </div>
      <div id="conduct">
            Participants in the libvirt project agree to abide by <a href="governance.html#code-of-conduct">the project code of conduct</a></div>
      <br class="clear"/>
    </div>
  </body>
</html>
