<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <!--
        This file is autogenerated from docs/drvxen.rst
        Do not edit this file. Changes will be lost.
      -->
  <!--
        This page was generated at Wed Apr 19 07:14:27 2023 UTC.
      -->
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" type="text/css" href="css/main.css"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/>
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/>
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/>
    <link rel="manifest" href="/manifest.json"/>
    <meta name="theme-color" content="#ffffff"/>
    <title>libvirt: libxl hypervisor driver for Xen</title>
    <meta name="description" content="libvirt, virtualization, virtualization API"/>
    <script type="text/javascript" src="js/main.js">
      <!--// forces non-empty element-->
    </script>
  </head>
  <body onload="pageload()">
    <div id="body">
      <div class="document" id="libxl-hypervisor-driver-for-xen">
<h1>libxl hypervisor driver for Xen</h1>

<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#project-links" id="id1">Project Links</a></p></li>
<li><p><a class="reference internal" href="#deployment-pre-requisites" id="id2">Deployment pre-requisites</a></p></li>
<li><p><a class="reference internal" href="#connections-to-libxl-driver" id="id3">Connections to libxl driver</a></p></li>
<li><p><a class="reference internal" href="#location-of-configuration-files" id="id4">Location of configuration files</a></p></li>
<li><p><a class="reference internal" href="#import-and-export-of-libvirt-domain-xml-configs" id="id5">Import and export of libvirt domain XML configs</a></p>
<ul>
<li><p><a class="reference internal" href="#converting-from-xm-config-files-to-domain-xml" id="id6">Converting from XM config files to domain XML</a></p></li>
<li><p><a class="reference internal" href="#converting-from-domain-xml-to-xm-config-files" id="id7">Converting from domain XML to XM config files</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#pass-through-of-arbitrary-command-line-arguments-to-the-qemu-device-model" id="id8">Pass-through of arbitrary command-line arguments to the qemu device model</a></p></li>
<li><p><a class="reference internal" href="#example-domain-xml-config" id="id9">Example domain XML config</a></p>
<ul>
<li><p><a class="reference internal" href="#paravirtualized-guest-bootloader" id="id10">Paravirtualized guest bootloader</a></p></li>
<li><p><a class="reference internal" href="#paravirtualized-guest-direct-kernel-boot" id="id11">Paravirtualized guest direct kernel boot</a></p></li>
<li><p><a class="reference internal" href="#fullyvirtualized-guest-bios-boot" id="id12">Fullyvirtualized guest BIOS boot</a></p></li>
<li><p><a class="reference internal" href="#fullyvirtualized-guest-direct-kernel-boot" id="id13">Fullyvirtualized guest direct kernel boot</a></p></li>
</ul>
</li>
</ul>
</div>
<p>The libvirt libxl driver provides the ability to manage virtual machines on any
Xen release from 4.6.0 onwards.</p>
<div class="section" id="project-links">
<h1><a class="toc-backref" href="#id1">Project Links</a><a class="headerlink" href="#project-links" title="Link to this headline">¶</a></h1>
<ul class="simple">
<li><p>The <a class="reference external" href="https://www.xenproject.org">Xen</a> hypervisor on Linux and Solaris
hosts</p></li>
</ul>
</div>
<div class="section" id="deployment-pre-requisites">
<h1><a class="toc-backref" href="#id2">Deployment pre-requisites</a><a class="headerlink" href="#deployment-pre-requisites" title="Link to this headline">¶</a></h1>
<p>The libvirt libxl driver uses Xen's libxl API, also known as libxenlight, to
implement libvirt's hypervisor driver functionality. libxl provides a
consolidated interface for managing a Xen host and its virtual machines, unlike
old versions of Xen where applications often had to communicate with xend,
xenstored, and the hypervisor itself via hypercalls. With libxl the only
pre-requisit is a properly installed Xen host with the libxl toolstack running
in a service domain (often Domain-0).</p>
</div>
<div class="section" id="connections-to-libxl-driver">
<h1><a class="toc-backref" href="#id3">Connections to libxl driver</a><a class="headerlink" href="#connections-to-libxl-driver" title="Link to this headline">¶</a></h1>
<p>The libvirt libxl driver is a single-instance privileged driver, with a driver
name of 'xen'. Some example connection URIs for the libxl driver are:</p>
<pre class="literal-block">xen:///system                     (local access, direct)
xen+unix:///system                (local access, via daemon)
xen://example.com/system          (remote access, TLS/x509)
xen+tcp://example.com/system      (remote access, SASl/Kerberos)
xen+ssh://root@example.com/system (remote access, SSH tunnelled)</pre>
</div>
<div class="section" id="location-of-configuration-files">
<h1><a class="toc-backref" href="#id4">Location of configuration files</a><a class="headerlink" href="#location-of-configuration-files" title="Link to this headline">¶</a></h1>
<p>The libxl driver comes with sane default values. However, during its
initialization it reads a configuration file which offers system administrator
to override some of that default. The file is located under
<span class="docutils literal">/etc/libvirt/libxl.conf</span></p>
</div>
<div class="section" id="import-and-export-of-libvirt-domain-xml-configs">
<h1><a class="toc-backref" href="#id5">Import and export of libvirt domain XML configs</a><a class="headerlink" href="#import-and-export-of-libvirt-domain-xml-configs" title="Link to this headline">¶</a></h1>
<p>The libxl driver currently supports three native config formats. The first,
known as <span class="docutils literal"><span class="pre">xen-xm</span></span>, is the original Xen virtual machine config format used by
the legacy xm/xend toolstack. The second, known as <span class="docutils literal"><span class="pre">xen-sxpr</span></span>, is also one of
the original formats that was used by xend's legacy HTTP RPC service (
<span class="since">removed in 5.6.0</span> )</p>
<p>The third format is <span class="docutils literal"><span class="pre">xen-xl</span></span>, which is the virtual machine config format
supported by modern Xen. The <span class="docutils literal"><span class="pre">xen-xl</span></span> format is described in the xl.cfg(5) man
page.</p>
<div class="section" id="converting-from-xm-config-files-to-domain-xml">
<h2><a class="toc-backref" href="#id6">Converting from XM config files to domain XML</a><a class="headerlink" href="#converting-from-xm-config-files-to-domain-xml" title="Link to this headline">¶</a></h2>
<p>The <span class="docutils literal">virsh <span class="pre">domxml-from-native</span></span> provides a way to convert an existing set of
xl, xm, or sxpr config files to libvirt Domain XML, which can then be used by
libvirt.</p>
<pre class="literal-block">$ virsh -c xen:///system domxml-from-native xen-xm rhel5.cfg
&lt;domain type='xen'&gt;
  &lt;name&gt;rhel5pv&lt;/name&gt;
  &lt;uuid&gt;8f07fe28-753f-2729-d76d-bdbd892f949a&lt;/uuid&gt;
  &lt;memory&gt;2560000&lt;/memory&gt;
  &lt;currentMemory&gt;307200&lt;/currentMemory&gt;
  &lt;vcpu&gt;4&lt;/vcpu&gt;
  &lt;bootloader&gt;/usr/bin/pygrub&lt;/bootloader&gt;
  &lt;os&gt;
    &lt;type arch='x86_64' machine='xenpv'&gt;linux&lt;/type&gt;
  &lt;/os&gt;
  &lt;clock offset='utc'/&gt;
  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
  &lt;on_crash&gt;restart&lt;/on_crash&gt;
  &lt;devices&gt;
    &lt;disk type='file' device='disk'&gt;
      &lt;driver name='tap' type='aio'/&gt;
      &lt;source file='/var/lib/xen/images/rhel5pv.img'/&gt;
      &lt;target dev='xvda' bus='xen'/&gt;
    &lt;/disk&gt;
    &lt;disk type='file' device='disk'&gt;
      &lt;driver name='tap' type='qcow'/&gt;
      &lt;source file='/root/qcow1-xen.img'/&gt;
      &lt;target dev='xvdd' bus='xen'/&gt;
    &lt;/disk&gt;
    &lt;interface type='bridge'&gt;
      &lt;mac address='00:16:3e:60:36:ba'/&gt;
      &lt;source bridge='xenbr0'/&gt;
    &lt;/interface&gt;
    &lt;console type='pty'&gt;
      &lt;target port='0'/&gt;
    &lt;/console&gt;
    &lt;input type='mouse' bus='xen'/&gt;
    &lt;graphics type='vnc' port='-1' autoport='yes' listen='0.0.0.0'/&gt;
  &lt;/devices&gt;
&lt;/domain&gt;</pre>
</div>
<div class="section" id="converting-from-domain-xml-to-xm-config-files">
<h2><a class="toc-backref" href="#id7">Converting from domain XML to XM config files</a><a class="headerlink" href="#converting-from-domain-xml-to-xm-config-files" title="Link to this headline">¶</a></h2>
<p>The <span class="docutils literal">virsh <span class="pre">domxml-to-native</span></span> provides a way to convert a guest description
using libvirt Domain XML into xl, xm, or sxpr config format.</p>
<pre class="literal-block">$ virsh -c xen:///system domxml-to-native xen-xm rhel5pv.xml
name = "rhel5pv"
uuid = "8f07fe28-753f-2729-d76d-bdbd892f949a"
maxmem = 2500
memory = 300
vcpus = 4
bootloader = "/usr/bin/pygrub"
kernel = "/var/lib/xen/boot_kernel.0YK-cS"
ramdisk = "/var/lib/xen/boot_ramdisk.vWgrxK"
extra = "ro root=/dev/VolGroup00/LogVol00 rhgb quiet"
on_poweroff = "destroy"
on_reboot = "restart"
on_crash = "restart"
sdl = 0
vnc = 1
vncunused = 1
vnclisten = "0.0.0.0"
disk = [ "tap:aio:/var/lib/xen/images/rhel5pv.img,xvda,w", "tap:qcow:/root/qcow1-xen.img,xvdd,w" ]
vif = [ "mac=00:16:3e:60:36:ba,bridge=virbr0,script=vif-bridge,vifname=vif5.0" ]</pre>
</div>
</div>
<div class="section" id="pass-through-of-arbitrary-command-line-arguments-to-the-qemu-device-model">
<h1><a class="toc-backref" href="#id8">Pass-through of arbitrary command-line arguments to the qemu device model</a><a class="headerlink" href="#pass-through-of-arbitrary-command-line-arguments-to-the-qemu-device-model" title="Link to this headline">¶</a></h1>
<p><span class="since">Since 6.7.0</span> , the Xen driver supports passing arbitrary command-line
arguments to the qemu device model used by Xen with the <span class="docutils literal">&lt;xen:commandline&gt;</span>
element under <span class="docutils literal">domain</span>. In order to use command-line pass-through, an XML
namespace request must be issued that pulls in
<span class="docutils literal"><span class="pre">http://libvirt.org/schemas/domain/xen/1.0</span></span>. With the namespace in place, it
is then possible to add <span class="docutils literal">&lt;xen:arg&gt;</span>sub-elements to <span class="docutils literal">&lt;xen:commandline&gt;</span>
describing each argument passed to the device model when starting the domain.</p>
<p>The following example illustrates passing arguments to the QEMU device model
that define a floppy drive, which Xen does not support through its public APIs:</p>
<pre class="literal-block">&lt;domain type="xen" xmlns:xen="http://libvirt.org/schemas/domain/xen/1.0"&gt;
  ...
  &lt;xen:commandline&gt;
    &lt;xen:arg value='-drive'/&gt;
    &lt;xen:arg value='file=/path/to/image,format=raw,if=none,id=drive-fdc0-0-0'/&gt;
    &lt;xen:arg value='-global'/&gt;
    &lt;xen:arg value='isa-fdc.driveA=drive-fdc0-0-0'/&gt;
  &lt;/xen:commandline&gt;
&lt;/domain&gt;</pre>
</div>
<div class="section" id="example-domain-xml-config">
<h1><a class="toc-backref" href="#id9">Example domain XML config</a><a class="headerlink" href="#example-domain-xml-config" title="Link to this headline">¶</a></h1>
<p>Below are some example XML configurations for Xen guest domains. For full
details of the available options, consult the <a class="reference external" href="formatdomain.html">domain XML
format</a> guide.</p>
<div class="section" id="paravirtualized-guest-bootloader">
<h2><a class="toc-backref" href="#id10">Paravirtualized guest bootloader</a><a class="headerlink" href="#paravirtualized-guest-bootloader" title="Link to this headline">¶</a></h2>
<p>Using a bootloader allows a paravirtualized guest to be booted using a kernel
stored inside its virtual disk image</p>
<pre class="literal-block">&lt;domain type='xen' &gt;
  &lt;name&gt;fc8&lt;/name&gt;
  &lt;bootloader&gt;/usr/bin/pygrub&lt;/bootloader&gt;
  &lt;os&gt;
    &lt;type&gt;linux&lt;/type&gt;
  &lt;/os&gt;
  &lt;memory&gt;131072&lt;/memory&gt;
  &lt;vcpu&gt;1&lt;/vcpu&gt;
  &lt;devices&gt;
    &lt;disk type='file'&gt;
      &lt;source file='/var/lib/xen/images/fc4.img'/&gt;
      &lt;target dev='sda1'/&gt;
    &lt;/disk&gt;
    &lt;interface type='bridge'&gt;
      &lt;source bridge='xenbr0'/&gt;
      &lt;mac address='aa:00:00:00:00:11'/&gt;
      &lt;script path='/etc/xen/scripts/vif-bridge'/&gt;
    &lt;/interface&gt;
    &lt;console tty='/dev/pts/5'/&gt;
  &lt;/devices&gt;
&lt;/domain&gt;</pre>
</div>
<div class="section" id="paravirtualized-guest-direct-kernel-boot">
<h2><a class="toc-backref" href="#id11">Paravirtualized guest direct kernel boot</a><a class="headerlink" href="#paravirtualized-guest-direct-kernel-boot" title="Link to this headline">¶</a></h2>
<p>For installation of paravirtualized guests it is typical to boot the domain
using a kernel and initrd stored in the host OS</p>
<pre class="literal-block">&lt;domain type='xen' &gt;
  &lt;name&gt;fc8&lt;/name&gt;
  &lt;os&gt;
    &lt;type&gt;linux&lt;/type&gt;
    &lt;kernel&gt;/var/lib/xen/install/vmlinuz-fedora8-x86_64&lt;/kernel&gt;
    &lt;initrd&gt;/var/lib/xen/install/initrd-vmlinuz-fedora8-x86_64&lt;/initrd&gt;
    &lt;cmdline&gt; kickstart=http://example.com/myguest.ks &lt;/cmdline&gt;
  &lt;/os&gt;
  &lt;memory&gt;131072&lt;/memory&gt;
  &lt;vcpu&gt;1&lt;/vcpu&gt;
  &lt;devices&gt;
    &lt;disk type='file'&gt;
      &lt;source file='/var/lib/xen/images/fc4.img'/&gt;
      &lt;target dev='sda1'/&gt;
    &lt;/disk&gt;
    &lt;interface type='bridge'&gt;
      &lt;source bridge='xenbr0'/&gt;
      &lt;mac address='aa:00:00:00:00:11'/&gt;
      &lt;script path='/etc/xen/scripts/vif-bridge'/&gt;
    &lt;/interface&gt;
    &lt;graphics type='vnc' port='-1'/&gt;
    &lt;console tty='/dev/pts/5'/&gt;
  &lt;/devices&gt;
&lt;/domain&gt;</pre>
</div>
<div class="section" id="fullyvirtualized-guest-bios-boot">
<h2><a class="toc-backref" href="#id12">Fullyvirtualized guest BIOS boot</a><a class="headerlink" href="#fullyvirtualized-guest-bios-boot" title="Link to this headline">¶</a></h2>
<p>Fullyvirtualized guests use the emulated BIOS to boot off the primary harddisk,
CDROM or Network PXE ROM.</p>
<pre class="literal-block">&lt;domain type='xen' id='3'&gt;
  &lt;name&gt;fv0&lt;/name&gt;
  &lt;uuid&gt;4dea22b31d52d8f32516782e98ab3fa0&lt;/uuid&gt;
  &lt;os&gt;
    &lt;type&gt;hvm&lt;/type&gt;
    &lt;loader&gt;/usr/lib/xen/boot/hvmloader&lt;/loader&gt;
    &lt;boot dev='hd'/&gt;
  &lt;/os&gt;
  &lt;memory&gt;524288&lt;/memory&gt;
  &lt;vcpu&gt;1&lt;/vcpu&gt;
  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
  &lt;on_crash&gt;restart&lt;/on_crash&gt;
  &lt;features&gt;
    &lt;pae/&gt;
    &lt;acpi/&gt;
    &lt;apic/&gt;
  &lt;/features&gt;
  &lt;clock sync="localtime"/&gt;
  &lt;devices&gt;
    &lt;emulator&gt;/usr/lib/xen/bin/qemu-dm&lt;/emulator&gt;
    &lt;interface type='bridge'&gt;
      &lt;source bridge='xenbr0'/&gt;
      &lt;mac address='00:16:3e:5d:c7:9e'/&gt;
      &lt;script path='vif-bridge'/&gt;
    &lt;/interface&gt;
    &lt;disk type='file'&gt;
      &lt;source file='/var/lib/xen/images/fv0'/&gt;
      &lt;target dev='hda'/&gt;
    &lt;/disk&gt;
    &lt;disk type='file' device='cdrom'&gt;
      &lt;source file='/var/lib/xen/images/fc5-x86_64-boot.iso'/&gt;
      &lt;target dev='hdc'/&gt;
      &lt;readonly/&gt;
    &lt;/disk&gt;
    &lt;disk type='file' device='floppy'&gt;
      &lt;source file='/root/fd.img'/&gt;
      &lt;target dev='fda'/&gt;
    &lt;/disk&gt;
    &lt;graphics type='vnc' port='5904'/&gt;
  &lt;/devices&gt;
&lt;/domain&gt;</pre>
</div>
<div class="section" id="fullyvirtualized-guest-direct-kernel-boot">
<h2><a class="toc-backref" href="#id13">Fullyvirtualized guest direct kernel boot</a><a class="headerlink" href="#fullyvirtualized-guest-direct-kernel-boot" title="Link to this headline">¶</a></h2>
<p>With Xen 3.2.0 or later it is possible to bypass the BIOS and directly boot a
Linux kernel and initrd as a fullyvirtualized domain. This allows for complete
automation of OS installation, for example using the Anaconda kickstart support.</p>
<pre class="literal-block">&lt;domain type='xen' id='3'&gt;
  &lt;name&gt;fv0&lt;/name&gt;
  &lt;uuid&gt;4dea22b31d52d8f32516782e98ab3fa0&lt;/uuid&gt;
  &lt;os&gt;
    &lt;type&gt;hvm&lt;/type&gt;
    &lt;loader&gt;/usr/lib/xen/boot/hvmloader&lt;/loader&gt;
    &lt;kernel&gt;/var/lib/xen/install/vmlinuz-fedora8-x86_64&lt;/kernel&gt;
    &lt;initrd&gt;/var/lib/xen/install/initrd-vmlinuz-fedora8-x86_64&lt;/initrd&gt;
    &lt;cmdline&gt; kickstart=http://example.com/myguest.ks &lt;/cmdline&gt;
  &lt;/os&gt;
  &lt;memory&gt;524288&lt;/memory&gt;
  &lt;vcpu&gt;1&lt;/vcpu&gt;
  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
  &lt;on_crash&gt;restart&lt;/on_crash&gt;
  &lt;features&gt;
    &lt;pae/&gt;
    &lt;acpi/&gt;
    &lt;apic/&gt;
  &lt;/features&gt;
  &lt;clock sync="localtime"/&gt;
  &lt;devices&gt;
    &lt;emulator&gt;/usr/lib/xen/bin/qemu-dm&lt;/emulator&gt;
    &lt;interface type='bridge'&gt;
      &lt;source bridge='xenbr0'/&gt;
      &lt;mac address='00:16:3e:5d:c7:9e'/&gt;
      &lt;script path='vif-bridge'/&gt;
    &lt;/interface&gt;
    &lt;disk type='file'&gt;
      &lt;source file='/var/lib/xen/images/fv0'/&gt;
      &lt;target dev='hda'/&gt;
    &lt;/disk&gt;
    &lt;disk type='file' device='cdrom'&gt;
      &lt;source file='/var/lib/xen/images/fc5-x86_64-boot.iso'/&gt;
      &lt;target dev='hdc'/&gt;
      &lt;readonly/&gt;
    &lt;/disk&gt;
    &lt;disk type='file' device='floppy'&gt;
      &lt;source file='/root/fd.img'/&gt;
      &lt;target dev='fda'/&gt;
    &lt;/disk&gt;
    &lt;graphics type='vnc' port='5904'/&gt;
  &lt;/devices&gt;
&lt;/domain&gt;</pre>
</div>
</div>
</div>
    </div>
    <div id="nav">
      <div id="home">
        <a href="index.html">Home</a>
      </div>
      <div id="jumplinks">
        <ul>
          <li>
            <a href="downloads.html">Download</a>
          </li>
          <li>
            <a href="contribute.html">Contribute</a>
          </li>
          <li>
            <a href="docs.html">Docs</a>
          </li>
        </ul>
      </div>
      <div id="search">
        <form id="simplesearch" action="https://www.google.com/search" enctype="application/x-www-form-urlencoded" method="get">
          <div>
            <input id="searchsite" name="sitesearch" type="hidden" value="libvirt.org"/>
            <input id="searchq" name="q" type="text" size="12" value=""/>
            <input name="submit" type="submit" value="Go"/>
          </div>
        </form>
        <div id="advancedsearch">
          <span>
            <input type="radio" name="what" id="whatwebsite" checked="checked" value="website"/>
            <label for="whatwebsite">Website</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatwiki" value="wiki"/>
            <label for="whatwiki">Wiki</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatdevs" value="devs"/>
            <label for="whatdevs">Developers list</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatusers" value="users"/>
            <label for="whatusers">Users list</label>
          </span>
        </div>
      </div>
    </div>
    <div id="footer">
      <div id="contact">
        <h3>Contact</h3>
        <ul>
          <li>
            <a href="contact.html#mailing-lists">email</a>
          </li>
          <li>
            <a href="contact.html#irc">irc</a>
          </li>
        </ul>
      </div>
      <div id="community">
        <h3>Community</h3>
        <ul>
          <li>
            <a href="https://twitter.com/hashtag/libvirt">twitter</a>
          </li>
          <li>
            <a href="https://stackoverflow.com/questions/tagged/libvirt">stackoverflow</a>
          </li>
          <li>
            <a href="https://serverfault.com/questions/tagged/libvirt">serverfault</a>
          </li>
        </ul>
      </div>
      <div id="contribute">
        <h3>Contribute</h3>
        <ul>
          <li>
            <a href="https://gitlab.com/libvirt/libvirt/-/blob/master/docs/drvxen.rst">edit this page</a>
          </li>
        </ul>
      </div>
      <div id="conduct">
            Participants in the libvirt project agree to abide by <a href="governance.html#code-of-conduct">the project code of conduct</a></div>
      <br class="clear"/>
    </div>
  </body>
</html>
