<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <!--
        This file is autogenerated from docs/drvbhyve.rst
        Do not edit this file. Changes will be lost.
      -->
  <!--
        This page was generated at Wed Apr 19 07:14:27 2023 UTC.
      -->
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" type="text/css" href="css/main.css"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/>
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/>
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/>
    <link rel="manifest" href="/manifest.json"/>
    <meta name="theme-color" content="#ffffff"/>
    <title>libvirt: Bhyve driver</title>
    <meta name="description" content="libvirt, virtualization, virtualization API"/>
    <script type="text/javascript" src="js/main.js">
      <!--// forces non-empty element-->
    </script>
  </head>
  <body onload="pageload()">
    <div id="body">
      <div class="document" id="bhyve-driver">
<h1>Bhyve driver</h1>

<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#connections-to-the-bhyve-driver" id="id1">Connections to the Bhyve driver</a></p></li>
<li><p><a class="reference internal" href="#example-guest-domain-xml-configurations" id="id2">Example guest domain XML configurations</a></p>
<ul>
<li><p><a class="reference internal" href="#example-config" id="id3">Example config</a></p></li>
<li><p><a class="reference internal" href="#example-config-linux-guest" id="id4">Example config (Linux guest)</a></p></li>
<li><p><a class="reference internal" href="#example-config-linux-uefi-guest-vnc-tablet" id="id5">Example config (Linux UEFI guest, VNC, tablet)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#guest-usage-management" id="id6">Guest usage / management</a></p>
<ul>
<li><p><a class="reference internal" href="#connecting-to-a-guest-console" id="id7">Connecting to a guest console</a></p></li>
<li><p><a class="reference internal" href="#converting-from-domain-xml-to-bhyve-args" id="id8">Converting from domain XML to Bhyve args</a></p></li>
<li><p><a class="reference internal" href="#using-zfs-volumes" id="id9">Using ZFS volumes</a></p></li>
<li><p><a class="reference internal" href="#using-grub2-bhyve-or-alternative-bootloaders" id="id10">Using grub2-bhyve or Alternative Bootloaders</a></p></li>
<li><p><a class="reference internal" href="#using-uefi-bootrom-vnc-and-usb-tablet" id="id11">Using UEFI bootrom, VNC, and USB tablet</a></p></li>
<li><p><a class="reference internal" href="#clock-configuration" id="id12">Clock configuration</a></p></li>
<li><p><a class="reference internal" href="#e1000-nic" id="id13">e1000 NIC</a></p></li>
<li><p><a class="reference internal" href="#sound-device" id="id14">Sound device</a></p></li>
<li><p><a class="reference internal" href="#virtio-9p-filesystem" id="id15">Virtio-9p filesystem</a></p></li>
<li><p><a class="reference internal" href="#wiring-guest-memory" id="id16">Wiring guest memory</a></p></li>
<li><p><a class="reference internal" href="#cpu-topology" id="id17">CPU topology</a></p></li>
<li><p><a class="reference internal" href="#ignoring-unknown-msrs-reads-and-writes" id="id18">Ignoring unknown MSRs reads and writes</a></p></li>
<li><p><a class="reference internal" href="#pass-through-of-arbitrary-bhyve-commands" id="id19">Pass-through of arbitrary bhyve commands</a></p></li>
</ul>
</li>
</ul>
</div>
<p>Bhyve is a FreeBSD hypervisor. It first appeared in FreeBSD 10.0. However, it's
recommended to keep tracking FreeBSD 10-STABLE to make sure all new features of
bhyve are supported. In order to enable bhyve on your FreeBSD host, you'll need
to load the <span class="docutils literal">vmm</span> kernel module. Additionally, <span class="docutils literal">if_tap</span> and <span class="docutils literal">if_bridge</span>
modules should be loaded for networking support. Also, <span class="since">since 3.2.0</span> the
<span class="docutils literal"><span class="pre">virt-host-validate(1)</span></span> supports the bhyve host validation and could be used
like this:</p>
<pre class="literal-block">$ virt-host-validate bhyve
 BHYVE: Checking for vmm module                                              : PASS
 BHYVE: Checking for if_tap module                                           : PASS
 BHYVE: Checking for if_bridge module                                        : PASS
 BHYVE: Checking for nmdm module                                             : PASS
$</pre>
<p>Additional information on bhyve could be obtained on
<a class="reference external" href="https://bhyve.org/">bhyve.org</a>.</p>
<div class="section" id="connections-to-the-bhyve-driver">
<h1><a class="toc-backref" href="#id1">Connections to the Bhyve driver</a><a class="headerlink" href="#connections-to-the-bhyve-driver" title="Link to this headline">¶</a></h1>
<p>The libvirt bhyve driver is a single-instance privileged driver. Some sample
connection URIs are:</p>
<pre class="literal-block">bhyve:///system                     (local access)
bhyve+unix:///system                (local access)
bhyve+ssh://root@example.com/system (remote access, SSH tunnelled)</pre>
</div>
<div class="section" id="example-guest-domain-xml-configurations">
<h1><a class="toc-backref" href="#id2">Example guest domain XML configurations</a><a class="headerlink" href="#example-guest-domain-xml-configurations" title="Link to this headline">¶</a></h1>
<div class="section" id="example-config">
<h2><a class="toc-backref" href="#id3">Example config</a><a class="headerlink" href="#example-config" title="Link to this headline">¶</a></h2>
<p>The bhyve driver in libvirt is in its early stage and under active development.
So it supports only limited number of features bhyve provides.</p>
<p>Note: in older libvirt versions, only a single network device and a single disk
device were supported per-domain. However, <span class="since">since 1.2.6</span> the libvirt
bhyve driver supports up to 31 PCI devices.</p>
<p>Note: the Bhyve driver in libvirt will boot whichever device is first. If you
want to install from CD, put the CD device first. If not, put the root HDD
first.</p>
<p>Note: Only the SATA bus is supported. Only <span class="docutils literal">cdrom</span>- and <span class="docutils literal">disk</span>-type disks
are supported.</p>
<pre class="literal-block">&lt;domain type='bhyve'&gt;
    &lt;name&gt;bhyve&lt;/name&gt;
    &lt;uuid&gt;df3be7e7-a104-11e3-aeb0-50e5492bd3dc&lt;/uuid&gt;
    &lt;memory&gt;219136&lt;/memory&gt;
    &lt;currentMemory&gt;219136&lt;/currentMemory&gt;
    &lt;vcpu&gt;1&lt;/vcpu&gt;
    &lt;os&gt;
       &lt;type&gt;hvm&lt;/type&gt;
    &lt;/os&gt;
    &lt;features&gt;
      &lt;apic/&gt;
      &lt;acpi/&gt;
    &lt;/features&gt;
    &lt;clock offset='utc'/&gt;
    &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
    &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
    &lt;on_crash&gt;destroy&lt;/on_crash&gt;
    &lt;devices&gt;
      &lt;disk type='file'&gt;
        &lt;driver name='file' type='raw'/&gt;
        &lt;source file='/path/to/bhyve_freebsd.img'/&gt;
        &lt;target dev='hda' bus='sata'/&gt;
      &lt;/disk&gt;
      &lt;disk type='file' device='cdrom'&gt;
        &lt;driver name='file' type='raw'/&gt;
        &lt;source file='/path/to/cdrom.iso'/&gt;
        &lt;target dev='hdc' bus='sata'/&gt;
        &lt;readonly/&gt;
      &lt;/disk&gt;
      &lt;interface type='bridge'&gt;
        &lt;model type='virtio'/&gt;
        &lt;source bridge="virbr0"/&gt;
      &lt;/interface&gt;
    &lt;/devices&gt;
&lt;/domain&gt;</pre>
<p>(The &lt;disk&gt; sections may be swapped in order to install from <em>cdrom.iso</em>.)</p>
</div>
<div class="section" id="example-config-linux-guest">
<h2><a class="toc-backref" href="#id4">Example config (Linux guest)</a><a class="headerlink" href="#example-config-linux-guest" title="Link to this headline">¶</a></h2>
<p>Note the addition of &lt;bootloader&gt;.</p>
<pre class="literal-block">&lt;domain type='bhyve'&gt;
    &lt;name&gt;linux_guest&lt;/name&gt;
    &lt;uuid&gt;df3be7e7-a104-11e3-aeb0-50e5492bd3dc&lt;/uuid&gt;
    &lt;memory&gt;131072&lt;/memory&gt;
    &lt;currentMemory&gt;131072&lt;/currentMemory&gt;
    &lt;vcpu&gt;1&lt;/vcpu&gt;
    &lt;bootloader&gt;/usr/local/sbin/grub-bhyve&lt;/bootloader&gt;
    &lt;os&gt;
       &lt;type&gt;hvm&lt;/type&gt;
    &lt;/os&gt;
    &lt;features&gt;
      &lt;apic/&gt;
      &lt;acpi/&gt;
    &lt;/features&gt;
    &lt;clock offset='utc'/&gt;
    &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
    &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
    &lt;on_crash&gt;destroy&lt;/on_crash&gt;
    &lt;devices&gt;
      &lt;disk type='file' device='disk'&gt;
        &lt;driver name='file' type='raw'/&gt;
        &lt;source file='/path/to/guest_hdd.img'/&gt;
        &lt;target dev='hda' bus='sata'/&gt;
      &lt;/disk&gt;
      &lt;disk type='file' device='cdrom'&gt;
        &lt;driver name='file' type='raw'/&gt;
        &lt;source file='/path/to/cdrom.iso'/&gt;
        &lt;target dev='hdc' bus='sata'/&gt;
        &lt;readonly/&gt;
      &lt;/disk&gt;
      &lt;interface type='bridge'&gt;
        &lt;model type='virtio'/&gt;
        &lt;source bridge="virbr0"/&gt;
      &lt;/interface&gt;
    &lt;/devices&gt;
&lt;/domain&gt;</pre>
</div>
<div class="section" id="example-config-linux-uefi-guest-vnc-tablet">
<h2><a class="toc-backref" href="#id5">Example config (Linux UEFI guest, VNC, tablet)</a><a class="headerlink" href="#example-config-linux-uefi-guest-vnc-tablet" title="Link to this headline">¶</a></h2>
<p>This is an example to boot into Fedora 25 installation:</p>
<pre class="literal-block">&lt;domain type='bhyve'&gt;
    &lt;name&gt;fedora_uefi_vnc_tablet&lt;/name&gt;
    &lt;memory unit='G'&gt;4&lt;/memory&gt;
    &lt;vcpu&gt;2&lt;/vcpu&gt;
    &lt;os&gt;
       &lt;type&gt;hvm&lt;/type&gt;
       &lt;loader readonly="yes" type="pflash"&gt;/usr/local/share/uefi-firmware/BHYVE_UEFI.fd&lt;/loader&gt;
    &lt;/os&gt;
    &lt;features&gt;
      &lt;apic/&gt;
      &lt;acpi/&gt;
    &lt;/features&gt;
    &lt;clock offset='utc'/&gt;
    &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
    &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
    &lt;on_crash&gt;destroy&lt;/on_crash&gt;
    &lt;devices&gt;
      &lt;disk type='file' device='cdrom'&gt;
        &lt;driver name='file' type='raw'/&gt;
          &lt;source file='/path/to/Fedora-Workstation-Live-x86_64-25-1.3.iso'/&gt;
        &lt;target dev='hdc' bus='sata'/&gt;
        &lt;readonly/&gt;
      &lt;/disk&gt;
      &lt;disk type='file' device='disk'&gt;
        &lt;driver name='file' type='raw'/&gt;
        &lt;source file='/path/to/linux_uefi.img'/&gt;
        &lt;target dev='hda' bus='sata'/&gt;
        &lt;/disk&gt;
      &lt;interface type='bridge'&gt;
        &lt;model type='virtio'/&gt;
        &lt;source bridge="virbr0"/&gt;
      &lt;/interface&gt;
      &lt;serial type="nmdm"&gt;
        &lt;source master="/dev/nmdm0A" slave="/dev/nmdm0B"/&gt;
      &lt;/serial&gt;
      &lt;graphics type='vnc' port='5904'&gt;
        &lt;listen type='address' address='127.0.0.1'/&gt;
      &lt;/graphics&gt;
      &lt;controller type='usb' model='nec-xhci'/&gt;
      &lt;input type='tablet' bus='usb'/&gt;
    &lt;/devices&gt;
&lt;/domain&gt;</pre>
<p>Please refer to the <a class="reference internal" href="#using-uefi-bootrom-vnc-and-usb-tablet">Using UEFI bootrom, VNC, and USB tablet</a> section for a
more detailed explanation.</p>
</div>
</div>
<div class="section" id="guest-usage-management">
<h1><a class="toc-backref" href="#id6">Guest usage / management</a><a class="headerlink" href="#guest-usage-management" title="Link to this headline">¶</a></h1>
<div class="section" id="connecting-to-a-guest-console">
<h2><a class="toc-backref" href="#id7">Connecting to a guest console</a><a class="headerlink" href="#connecting-to-a-guest-console" title="Link to this headline">¶</a></h2>
<p>Guest console connection is supported through the <span class="docutils literal">nmdm</span> device. It could be
enabled by adding the following to the domain XML ( <span class="since">Since 1.2.4</span> ):</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;serial type="nmdm"&gt;
    &lt;source master="/dev/nmdm0A" slave="/dev/nmdm0B"/&gt;
  &lt;/serial&gt;
&lt;/devices&gt;
...</pre>
<p>Make sure to load the <span class="docutils literal">nmdm</span> kernel module if you plan to use that.</p>
<p>Then <span class="docutils literal">virsh console</span> command can be used to connect to the text console of a
guest.</p>
<p><strong>NB:</strong> Some versions of bhyve have a bug that prevents guests from booting
until the console is opened by a client. This bug was fixed in <a class="reference external" href="https://svnweb.freebsd.org/changeset/base/262884">FreeBSD
changeset r262884</a>. If an
older version is used, one either has to open a console manually with
<span class="docutils literal">virsh console</span> to let a guest boot or start a guest using:</p>
<pre class="literal-block">start --console domname</pre>
<p><strong>NB:</strong> A bootloader configured to require user interaction will prevent the
domain from starting (and thus <span class="docutils literal">virsh console</span> or <span class="docutils literal">start <span class="pre">--console</span></span> from
functioning) until the user interacts with it manually on the VM host. Because
users typically do not have access to the VM host, interactive bootloaders are
unsupported by libvirt. <em>However,</em> if you happen to run into this scenario and
also happen to have access to the Bhyve host machine, you may select a boot
option and allow the domain to finish starting by using an alternative terminal
client on the VM host to connect to the domain-configured null modem device. One
example (assuming <span class="docutils literal">/dev/nmdm0B</span> is configured as the slave end of the domain
serial device) is:</p>
<pre class="literal-block">cu -l /dev/nmdm0B</pre>
</div>
<div class="section" id="converting-from-domain-xml-to-bhyve-args">
<h2><a class="toc-backref" href="#id8">Converting from domain XML to Bhyve args</a><a class="headerlink" href="#converting-from-domain-xml-to-bhyve-args" title="Link to this headline">¶</a></h2>
<p>The <span class="docutils literal">virsh <span class="pre">domxml-to-native</span></span> command can preview the actual <span class="docutils literal">bhyve</span> commands
that will be executed for a given domain. It outputs two lines, the first line
is a <span class="docutils literal">bhyveload</span> command and the second is a <span class="docutils literal">bhyve</span> command.</p>
<p>Please note that the <span class="docutils literal">virsh <span class="pre">domxml-to-native</span></span> doesn't do any real actions
other than printing the command, for example, it doesn't try to find a proper
TAP interface and create it, like what is done when starting a domain; and
always returns <span class="docutils literal">tap0</span> for the network interface. So if you're going to run
these commands manually, most likely you might want to tweak them.</p>
<pre class="literal-block"># virsh -c "bhyve:///system"  domxml-to-native --format bhyve-argv --xml /path/to/bhyve.xml
/usr/sbin/bhyveload -m 214 -d /home/user/vm1.img vm1
/usr/sbin/bhyve -c 2 -m 214 -A -I -H -P -s 0:0,hostbridge \
    -s 3:0,virtio-net,tap0,mac=52:54:00:5d:74:e3 -s 2:0,virtio-blk,/home/user/vm1.img \
    -s 1,lpc -l com1,/dev/nmdm0A vm1</pre>
</div>
<div class="section" id="using-zfs-volumes">
<h2><a class="toc-backref" href="#id9">Using ZFS volumes</a><a class="headerlink" href="#using-zfs-volumes" title="Link to this headline">¶</a></h2>
<p>It's possible to use ZFS volumes as disk devices <span class="since">since 1.2.8</span> . An
example of domain XML device entry for that will look like:</p>
<pre class="literal-block">...
&lt;disk type='volume' device='disk'&gt;
  &lt;source pool='zfspool' volume='vol1'/&gt;
  &lt;target dev='vdb' bus='virtio'/&gt;
&lt;/disk&gt;
...</pre>
<p>Please refer to the <a class="reference external" href="storage.html">Storage documentation</a> for more details on
storage management.</p>
</div>
<div class="section" id="using-grub2-bhyve-or-alternative-bootloaders">
<h2><a class="toc-backref" href="#id10">Using grub2-bhyve or Alternative Bootloaders</a><a class="headerlink" href="#using-grub2-bhyve-or-alternative-bootloaders" title="Link to this headline">¶</a></h2>
<p>It's possible to boot non-FreeBSD guests by specifying an explicit bootloader,
e.g. <span class="docutils literal"><span class="pre">grub-bhyve(1)</span></span>. Arguments to the bootloader may be specified as well. If
the bootloader is <span class="docutils literal"><span class="pre">grub-bhyve</span></span> and arguments are omitted, libvirt will try and
infer boot ordering from user-supplied &lt;boot order='N'&gt; configuration in the
domain. Failing that, it will boot the first disk in the domain (either
<span class="docutils literal">cdrom</span>- or <span class="docutils literal">disk</span>-type devices). If the disk type is <span class="docutils literal">disk</span>, it will
attempt to boot from the first partition in the disk image.</p>
<pre class="literal-block">...
&lt;bootloader&gt;/usr/local/sbin/grub-bhyve&lt;/bootloader&gt;
&lt;bootloader_args&gt;...&lt;/bootloader_args&gt;
...</pre>
<p>Caveat: <span class="docutils literal">bootloader_args</span> does not support any quoting. Filenames, etc, must
not have spaces or they will be tokenized incorrectly.</p>
</div>
<div class="section" id="using-uefi-bootrom-vnc-and-usb-tablet">
<h2><a class="toc-backref" href="#id11">Using UEFI bootrom, VNC, and USB tablet</a><a class="headerlink" href="#using-uefi-bootrom-vnc-and-usb-tablet" title="Link to this headline">¶</a></h2>
<p><span class="since">Since 3.2.0</span> , in addition to
<a class="reference internal" href="#using-grub2-bhyve-or-alternative-bootloaders">Using grub2-bhyve or Alternative Bootloaders</a>, non-FreeBSD
guests could be also booted using an UEFI boot ROM, provided both guest OS and
installed <span class="docutils literal">bhyve(1)</span> version support UEFI. To use that, <span class="docutils literal">loader</span> should be
specified in the <span class="docutils literal">os</span> section:</p>
<pre class="literal-block">&lt;domain type='bhyve'&gt;
    ...
    &lt;os&gt;
       &lt;type&gt;hvm&lt;/type&gt;
       &lt;loader readonly="yes" type="pflash"&gt;/usr/local/share/uefi-firmware/BHYVE_UEFI.fd&lt;/loader&gt;
    &lt;/os&gt;
    ...</pre>
<p>This uses the UEFI firmware provided by the
<a class="reference external" href="https://www.freshports.org/sysutils/bhyve-firmware/">sysutils/bhyve-firmware</a>
FreeBSD port.</p>
<p>VNC and the tablet input device could be configured this way:</p>
<pre class="literal-block">&lt;domain type='bhyve'&gt;
    &lt;devices&gt;
      ...
      &lt;graphics type='vnc' port='5904'&gt;
        &lt;listen type='address' address='127.0.0.1'/&gt;
      &lt;/graphics&gt;
      &lt;controller type='usb' model='nec-xhci'/&gt;
      &lt;input type='tablet' bus='usb'/&gt;
    &lt;/devices&gt;
    ...
&lt;/domain&gt;</pre>
<p>This way, VNC will be accessible on <span class="docutils literal">127.0.0.1:5904</span>.</p>
<p>Please note that the tablet device requires to have a USB controller of the
<span class="docutils literal"><span class="pre">nec-xhci</span></span> model. Currently, only a single controller of this type and a
single tablet are supported per domain.</p>
<p><span class="since">Since 3.5.0</span> , it's possible to configure how the video device is
exposed to the guest using the <span class="docutils literal">vgaconf</span> attribute:</p>
<pre class="literal-block">&lt;domain type='bhyve'&gt;
    &lt;devices&gt;
    ...
      &lt;graphics type='vnc' port='5904'&gt;
        &lt;listen type='address' address='127.0.0.1'/&gt;
      &lt;/graphics&gt;
      &lt;video&gt;
        &lt;driver vgaconf='on'/&gt;
        &lt;model type='gop' heads='1' primary='yes'/&gt;
      &lt;/video&gt;
      ...
    &lt;/devices&gt;
    ...
&lt;/domain&gt;</pre>
<p>If not specified, bhyve's default mode for <span class="docutils literal">vgaconf</span> will be used. Please
refer to the
<a class="reference external" href="https://www.freebsd.org/cgi/man.cgi?query=bhyve&amp;sektion=8&amp;manpath=FreeBSD+12-current">bhyve(8)</a>
manual page and the <a class="reference external" href="https://wiki.freebsd.org/bhyve">bhyve wiki</a> for more
details on using the <span class="docutils literal">vgaconf</span> option.</p>
<p><span class="since">Since 3.7.0</span> , it's possible to use <span class="docutils literal">autoport</span> to let libvirt allocate
VNC port automatically (instead of explicitly specifying it with the <span class="docutils literal">port</span>
attribute):</p>
<pre class="literal-block">&lt;graphics type='vnc' autoport='yes'&gt;</pre>
<p><span class="since">Since 6.8.0</span> , it's possible to set framebuffer resolution using the
<span class="docutils literal">resolution</span> sub-element:</p>
<pre class="literal-block">&lt;video&gt;
  &lt;model type='gop' heads='1' primary='yes'&gt;
    &lt;resolution x='800' y='600'/&gt;
  &lt;/model&gt;
&lt;/video&gt;</pre>
<p><span class="since">Since 6.8.0</span> , VNC server can be configured to use password based
authentication:</p>
<pre class="literal-block">&lt;graphics type='vnc' port='5904' passwd='foobar'&gt;
  &lt;listen type='address' address='127.0.0.1'/&gt;
&lt;/graphics&gt;</pre>
<p>Note: VNC password authentication is known to be cryptographically weak.
Additionally, the password is passed as a command line argument in clear text.
Make sure you understand the risks associated with this feature before using it.</p>
</div>
<div class="section" id="clock-configuration">
<h2><a class="toc-backref" href="#id12">Clock configuration</a><a class="headerlink" href="#clock-configuration" title="Link to this headline">¶</a></h2>
<p>Originally bhyve supported only localtime for RTC. Support for UTC time was
introduced in <a class="reference external" href="https://svnweb.freebsd.org/changeset/base/284894">FreeBSD changeset
r284894</a> for <em>10-STABLE</em>
and in <a class="reference external" href="https://svnweb.freebsd.org/changeset/base/279225">changeset r279225</a>
for <em>-CURRENT</em>. It's possible to use this in libvirt <span class="since">since 1.2.18</span> ,
just place the following to domain XML:</p>
<pre class="literal-block">&lt;domain type="bhyve"&gt;
    ...
    &lt;clock offset='utc'/&gt;
    ...
&lt;/domain&gt;</pre>
<p>Please note that if you run the older bhyve version that doesn't support UTC
time, you'll fail to start a domain. As UTC is used as a default when you do not
specify clock settings, you'll need to explicitly specify 'localtime' in this
case:</p>
<pre class="literal-block">&lt;domain type="bhyve"&gt;
    ...
    &lt;clock offset='localtime'/&gt;
    ...
&lt;/domain&gt;</pre>
</div>
<div class="section" id="e1000-nic">
<h2><a class="toc-backref" href="#id13">e1000 NIC</a><a class="headerlink" href="#e1000-nic" title="Link to this headline">¶</a></h2>
<p>As of <a class="reference external" href="https://svnweb.freebsd.org/changeset/base/302504">FreeBSD changeset
r302504</a> bhyve supports
Intel e1000 network adapter emulation. It's supported in libvirt <span class="since">since
3.1.0</span> and could be used as follows:</p>
<pre class="literal-block">...
    &lt;interface type='bridge'&gt;
      &lt;source bridge='virbr0'/&gt;
      &lt;model type='e1000'/&gt;
    &lt;/interface&gt;
...</pre>
</div>
<div class="section" id="sound-device">
<h2><a class="toc-backref" href="#id14">Sound device</a><a class="headerlink" href="#sound-device" title="Link to this headline">¶</a></h2>
<p>As of <a class="reference external" href="https://svnweb.freebsd.org/changeset/base/349355">FreeBSD changeset
r349355</a> bhyve supports
sound device emulation. It's supported in libvirt <span class="since">since 6.7.0</span> .</p>
<pre class="literal-block">...
  &lt;sound model='ich7'&gt;
    &lt;audio id='1'/&gt;
  &lt;/sound&gt;
  &lt;audio id='1' type='oss'&gt;
    &lt;input dev='/dev/dsp0'/&gt;
    &lt;output dev='/dev/dsp0'/&gt;
  &lt;/audio&gt;
...</pre>
<p>Here, the <span class="docutils literal">sound</span> element specifies the sound device as it's exposed to the
guest, with <span class="docutils literal">ich7</span> being the only supported model now, and the <span class="docutils literal">audio</span>
element specifies how the guest device is mapped to the host sound device.</p>
</div>
<div class="section" id="virtio-9p-filesystem">
<h2><a class="toc-backref" href="#id15">Virtio-9p filesystem</a><a class="headerlink" href="#virtio-9p-filesystem" title="Link to this headline">¶</a></h2>
<p>As of <a class="reference external" href="https://svnweb.freebsd.org/changeset/base/366413">FreeBSD changeset
r366413</a> bhyve supports
sharing arbitrary directory tree between the guest and the host. It's supported
in libvirt <span class="since">since 6.9.0</span> .</p>
<pre class="literal-block">...
  &lt;filesystem&gt;
    &lt;source dir='/shared/dir'/&gt;
    &lt;target dir='shared_dir'/&gt;
  &lt;/filesystem&gt;
...</pre>
<p>This share could be made read only by adding the <span class="docutils literal">&lt;readonly/&gt;</span> sub-element.</p>
<p>In the Linux guest, this could be mounted using:</p>
<pre class="literal-block">mount -t 9p shared_dir /mnt/shared_dir</pre>
</div>
<div class="section" id="wiring-guest-memory">
<h2><a class="toc-backref" href="#id16">Wiring guest memory</a><a class="headerlink" href="#wiring-guest-memory" title="Link to this headline">¶</a></h2>
<p><span class="since">Since 4.4.0</span> , it's possible to specify that guest memory should be
wired and cannot be swapped out as follows:</p>
<pre class="literal-block">&lt;domain type="bhyve"&gt;
    ...
    &lt;memoryBacking&gt;
      &lt;locked/&gt;
    &lt;/memoryBacking&gt;
    ...
&lt;/domain&gt;</pre>
</div>
<div class="section" id="cpu-topology">
<h2><a class="toc-backref" href="#id17">CPU topology</a><a class="headerlink" href="#cpu-topology" title="Link to this headline">¶</a></h2>
<p><span class="since">Since 4.5.0</span> , it's possible to specify guest CPU topology, if bhyve
supports that. Support for specifying guest CPU topology was added to bhyve in
<a class="reference external" href="https://svnweb.freebsd.org/changeset/base/332298">FreeBSD changeset r332298</a>
for <em>-CURRENT</em>. Example:</p>
<pre class="literal-block">&lt;domain type="bhyve"&gt;
    ...
    &lt;cpu&gt;
      &lt;topology sockets='1' cores='2' threads='1'/&gt;
    &lt;/cpu&gt;
    ...
&lt;/domain&gt;</pre>
</div>
<div class="section" id="ignoring-unknown-msrs-reads-and-writes">
<h2><a class="toc-backref" href="#id18">Ignoring unknown MSRs reads and writes</a><a class="headerlink" href="#ignoring-unknown-msrs-reads-and-writes" title="Link to this headline">¶</a></h2>
<p><span class="since">Since 5.1.0</span> , it's possible to make bhyve ignore accesses to
unimplemented Model Specific Registers (MSRs). Example:</p>
<pre class="literal-block">&lt;domain type="bhyve"&gt;
    ...
    &lt;features&gt;
      ...
      &lt;msrs unknown='ignore'/&gt;
      ...
    &lt;/features&gt;
    ...
&lt;/domain&gt;</pre>
</div>
<div class="section" id="pass-through-of-arbitrary-bhyve-commands">
<h2><a class="toc-backref" href="#id19">Pass-through of arbitrary bhyve commands</a><a class="headerlink" href="#pass-through-of-arbitrary-bhyve-commands" title="Link to this headline">¶</a></h2>
<p><span class="since">Since 5.1.0</span> , it's possible to pass additional command-line arguments
to the bhyve process when starting the domain using the <span class="docutils literal">&lt;bhyve:commandline&gt;</span>
element under <span class="docutils literal">domain</span>. To supply an argument, use the element <span class="docutils literal">&lt;bhyve:arg&gt;</span>
with the attribute <span class="docutils literal">value</span> set to additional argument to be added. The arg
element may be repeated multiple times. To use this XML addition, it is
necessary to issue an XML namespace request (the special <span class="docutils literal">xmlns:name</span>
attribute) that pulls in <span class="docutils literal"><span class="pre">http://libvirt.org/schemas/domain/bhyve/1.0</span></span>;
typically, the namespace is given the name of <span class="docutils literal">bhyve</span>.</p>
<p>Example:</p>
<pre class="literal-block">&lt;domain type="bhyve" xmlns:bhyve="http://libvirt.org/schemas/domain/bhyve/1.0"&gt;
  ...
  &lt;bhyve:commandline&gt;
    &lt;bhyve:arg value='-somebhyvearg'/&gt;
  &lt;/bhyve:commandline&gt;
&lt;/domain&gt;</pre>
<p>Note that these extensions are for testing and development purposes only. They
are <strong>unsupported</strong>, using them may result in inconsistent state, and upgrading
either bhyve or libvirtd maybe break behavior of a domain that was relying on a
specific commands pass-through.</p>
</div>
</div>
</div>
    </div>
    <div id="nav">
      <div id="home">
        <a href="index.html">Home</a>
      </div>
      <div id="jumplinks">
        <ul>
          <li>
            <a href="downloads.html">Download</a>
          </li>
          <li>
            <a href="contribute.html">Contribute</a>
          </li>
          <li>
            <a href="docs.html">Docs</a>
          </li>
        </ul>
      </div>
      <div id="search">
        <form id="simplesearch" action="https://www.google.com/search" enctype="application/x-www-form-urlencoded" method="get">
          <div>
            <input id="searchsite" name="sitesearch" type="hidden" value="libvirt.org"/>
            <input id="searchq" name="q" type="text" size="12" value=""/>
            <input name="submit" type="submit" value="Go"/>
          </div>
        </form>
        <div id="advancedsearch">
          <span>
            <input type="radio" name="what" id="whatwebsite" checked="checked" value="website"/>
            <label for="whatwebsite">Website</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatwiki" value="wiki"/>
            <label for="whatwiki">Wiki</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatdevs" value="devs"/>
            <label for="whatdevs">Developers list</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatusers" value="users"/>
            <label for="whatusers">Users list</label>
          </span>
        </div>
      </div>
    </div>
    <div id="footer">
      <div id="contact">
        <h3>Contact</h3>
        <ul>
          <li>
            <a href="contact.html#mailing-lists">email</a>
          </li>
          <li>
            <a href="contact.html#irc">irc</a>
          </li>
        </ul>
      </div>
      <div id="community">
        <h3>Community</h3>
        <ul>
          <li>
            <a href="https://twitter.com/hashtag/libvirt">twitter</a>
          </li>
          <li>
            <a href="https://stackoverflow.com/questions/tagged/libvirt">stackoverflow</a>
          </li>
          <li>
            <a href="https://serverfault.com/questions/tagged/libvirt">serverfault</a>
          </li>
        </ul>
      </div>
      <div id="contribute">
        <h3>Contribute</h3>
        <ul>
          <li>
            <a href="https://gitlab.com/libvirt/libvirt/-/blob/master/docs/drvbhyve.rst">edit this page</a>
          </li>
        </ul>
      </div>
      <div id="conduct">
            Participants in the libvirt project agree to abide by <a href="governance.html#code-of-conduct">the project code of conduct</a></div>
      <br class="clear"/>
    </div>
  </body>
</html>
