<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <!--
        This file is autogenerated from docs/logging.rst
        Do not edit this file. Changes will be lost.
      -->
  <!--
        This page was generated at Wed Apr 19 07:14:27 2023 UTC.
      -->
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" type="text/css" href="css/main.css"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/>
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/>
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/>
    <link rel="manifest" href="/manifest.json"/>
    <meta name="theme-color" content="#ffffff"/>
    <title>libvirt: Logging in the library and the daemon</title>
    <meta name="description" content="libvirt, virtualization, virtualization API"/>
    <script type="text/javascript" src="js/main.js">
      <!--// forces non-empty element-->
    </script>
  </head>
  <body onload="pageload()">
    <div id="body">
      <div class="document" id="logging-in-the-library-and-the-daemon">
<h1>Logging in the library and the daemon</h1>

<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#logging-in-the-library" id="id1">Logging in the library</a></p></li>
<li><p><a class="reference internal" href="#configuring-logging-in-the-library" id="id2">Configuring logging in the library</a></p></li>
<li><p><a class="reference internal" href="#logging-in-the-daemon" id="id3">Logging in the daemon</a></p></li>
<li><p><a class="reference internal" href="#syntax-for-filters-and-output-values" id="id4">Syntax for filters and output values</a></p></li>
<li><p><a class="reference internal" href="#systemd-journal-fields" id="id5">Systemd journal fields</a></p>
<ul>
<li><p><a class="reference internal" href="#well-known-message-id-values" id="id6">Well known message ID values</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#examples" id="id7">Examples</a></p></li>
</ul>
</div>
<p>Libvirt includes logging facilities starting from version 0.6.0, this
complements the <a class="reference external" href="errors.html">error handling</a> mechanism and APIs to allow
tracing through the execution of the library as well as in the libvirtd daemon.</p>
<div class="section" id="logging-in-the-library">
<h1><a class="toc-backref" href="#id1">Logging in the library</a><a class="headerlink" href="#logging-in-the-library" title="Link to this headline">¶</a></h1>
<p>The logging functionalities in libvirt are based on 3 key concepts, similar to
the one present in other generic logging facilities like log4j:</p>
<ul class="simple">
<li><p><strong>log messages</strong>: they are information generated at runtime by the libvirt
code. Each message includes a priority level (DEBUG = 1, INFO = 2, WARNING =
3, ERROR = 4), a category, function name and line number, indicating where it
originated from, and finally a formatted message. In addition the library
adds a timestamp at the beginning of the message</p></li>
<li><p><strong>log filters</strong>: a set of patterns and priorities to accept or reject a log
message. If the message category matches a filter, the message priority is
compared to the filter priority, if lower the message is discarded, if higher
the message is output. If no filter matches, then a general priority level is
applied to all remaining messages. This allows, for example, capturing all
debug messages for the QEMU driver, but otherwise only allowing errors to
show up from other parts.</p></li>
<li><p><strong>log outputs</strong>: once a message has gone through filtering a set of output
defines where to send the message, they can also filter based on the
priority, for example it may be useful to output all messages to a debugging
file but only allow errors to be logged through syslog.</p></li>
</ul>
</div>
<div class="section" id="configuring-logging-in-the-library">
<h1><a class="toc-backref" href="#id2">Configuring logging in the library</a><a class="headerlink" href="#configuring-logging-in-the-library" title="Link to this headline">¶</a></h1>
<p>The library configuration of logging is through 3 environment variables allowing
to control the logging behaviour:</p>
<ul class="simple">
<li><p>LIBVIRT_DEBUG: it can take the four following values:</p>
<ul>
<li><p>1 or "debug": asking the library to log every message emitted, though the
filters can be used to avoid filling up the output</p></li>
<li><p>2 or "info": log all non-debugging information</p></li>
<li><p>3 or "warn": log warnings and errors, that's the default value</p></li>
<li><p>4 or "error": log only error messages</p></li>
</ul>
</li>
<li><p>LIBVIRT_LOG_FILTERS: defines logging filters</p></li>
<li><p>LIBVIRT_LOG_OUTPUTS: defines logging outputs</p></li>
</ul>
<p>Note that, for example, setting LIBVIRT_DEBUG= is the same as unset. If you
specify an invalid value, it will be ignored with a warning. If you have an
error in a filter or output string, some of the settings may be applied up to
the point at which libvirt encountered the error.</p>
</div>
<div class="section" id="logging-in-the-daemon">
<h1><a class="toc-backref" href="#id3">Logging in the daemon</a><a class="headerlink" href="#logging-in-the-daemon" title="Link to this headline">¶</a></h1>
<p>Similarly the daemon logging behaviour can be tuned using 3 config variables,
stored in the configuration file:</p>
<ul class="simple">
<li><p>log_level: accepts the following values:</p>
<ul>
<li><p>4: only errors</p></li>
<li><p>3: warnings and errors</p></li>
<li><p>2: information, warnings and errors</p></li>
<li><p>1: debug and everything</p></li>
</ul>
</li>
<li><p>log_filters: defines logging filters</p></li>
<li><p>log_outputs: defines logging outputs</p></li>
</ul>
<p>When starting the libvirt daemon, any logging environment variable settings will
override settings in the config file. Command line options take precedence over
all. If no outputs are defined for libvirtd, it will try to use</p>
<ul class="simple">
<li><p>0.10.0 or later: systemd journal, if <span class="docutils literal">/run/systemd/journal/socket</span> exists</p></li>
<li><p>0.9.0 or later: file <span class="docutils literal">/var/log/libvirt/libvirtd.log</span> if running as a daemon</p></li>
<li><p>before 0.9.0: syslog if running as a daemon</p></li>
<li><p>all versions: to stderr stream if running in the foreground</p></li>
</ul>
<p>Libvirtd does not reload its logging configuration when issued a SIGHUP. If you
want to reload the configuration, you must do a
<span class="docutils literal">service        libvirtd restart</span> or manually stop and restart the daemon
yourself.</p>
<p>Starting from 0.9.0, the daemon can save all the content of the debug buffer to
the defined error channels (or /var/log/libvirt/libvirtd.log by default) in case
of crash, this can also be activated explicitly for debugging purposes by
sending the daemon a USR2 signal:</p>
<pre class="literal-block">killall -USR2 libvirtd</pre>
</div>
<div class="section" id="syntax-for-filters-and-output-values">
<h1><a class="toc-backref" href="#id4">Syntax for filters and output values</a><a class="headerlink" href="#syntax-for-filters-and-output-values" title="Link to this headline">¶</a></h1>
<p>The syntax for filters and outputs is the same for both types of variables.</p>
<p>The format for a filter is:</p>
<pre class="literal-block">x:name</pre>
<p>where <span class="docutils literal">name</span> is a string which is matched against the category given in the
VIR_LOG_INIT() at the top of each libvirt source file, e.g., <span class="docutils literal">remote</span>,
<span class="docutils literal">qemu</span>, or <span class="docutils literal">util.json</span> (the name in the filter can be a substring of the
full category name, in order to match multiple similar categories), and <span class="docutils literal">x</span> is
the minimal level where matching messages should be logged:</p>
<ul class="simple">
<li><p>1: DEBUG</p></li>
<li><p>2: INFO</p></li>
<li><p>3: WARNING</p></li>
<li><p>4: ERROR</p></li>
</ul>
<p>Multiple filters can be defined in a single string, they just need to be
separated by spaces, e.g: <span class="docutils literal">"3:remote 4:event"</span> to only get warning or errors
from the remote layer and only errors from the event layer.</p>
<p>If you specify a log priority in a filter that is below the default log priority
level, messages that match that filter will still be logged, while others will
not. In order to see those messages, you must also have an output defined that
includes the priority level of your filter.</p>
<p>The format for an output can be one of the following forms:</p>
<ul class="simple">
<li><p><span class="docutils literal">x:stderr</span> output goes to stderr</p></li>
<li><p><span class="docutils literal">x:syslog:name</span> use syslog for the output and use the given <span class="docutils literal">name</span> as the
ident</p></li>
<li><p><span class="docutils literal">x:file:file_path</span> output to a file, with the given filepath</p></li>
<li><p><span class="docutils literal">x:journald</span> output goes to systemd journal</p></li>
</ul>
<p>In all cases the x prefix is the minimal level, acting as a filter:</p>
<ul class="simple">
<li><p>1: DEBUG</p></li>
<li><p>2: INFO</p></li>
<li><p>3: WARNING</p></li>
<li><p>4: ERROR</p></li>
</ul>
<p>Multiple output can be defined, they just need to be separated by spaces, e.g.:
<span class="docutils literal">"3:syslog:libvirtd <span class="pre">1:file:/tmp/libvirt.log"</span></span> will log all warnings and errors
to syslog under the libvirtd ident but also log all debug and information
included in the file <span class="docutils literal">/tmp/libvirt.log</span></p>
</div>
<div class="section" id="systemd-journal-fields">
<h1><a class="toc-backref" href="#id5">Systemd journal fields</a><a class="headerlink" href="#systemd-journal-fields" title="Link to this headline">¶</a></h1>
<p>When logging to the systemd journal, the following fields are defined, in
addition to any automatically recorded <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/systemd.journal-fields.html">standard
fields</a>:</p>
<dl class="simple">
<dt><span class="docutils literal">MESSAGE</span></dt>
<dd><p>The log message string</p>
</dd>
<dt><span class="docutils literal">PRIORITY</span></dt>
<dd><p>The log priority value</p>
</dd>
<dt><span class="docutils literal">LIBVIRT_SOURCE</span></dt>
<dd><p>The source type, one of "file", "error", "audit", "trace", "library"</p>
</dd>
<dt><span class="docutils literal">CODE_FILE</span></dt>
<dd><p>The name of the file emitting the log record</p>
</dd>
<dt><span class="docutils literal">CODE_LINE</span></dt>
<dd><p>The line number of the file emitting the log record</p>
</dd>
<dt><span class="docutils literal">CODE_FUNC</span></dt>
<dd><p>The name of the function emitting the log record</p>
</dd>
<dt><span class="docutils literal">LIBVIRT_DOMAIN</span></dt>
<dd><p>The libvirt error domain (values from virErrorDomain enum), if
LIBVIRT_SOURCE="error"</p>
</dd>
<dt><span class="docutils literal">LIBVIRT_CODE</span></dt>
<dd><p>The libvirt error code (values from virErrorCode enum), if
LIBVIRT_SOURCE="error"</p>
</dd>
</dl>
<div class="section" id="well-known-message-id-values">
<h2><a class="toc-backref" href="#id6">Well known message ID values</a><a class="headerlink" href="#well-known-message-id-values" title="Link to this headline">¶</a></h2>
<p>Certain areas of the code will emit log records tagged with well known unique id
values, which are guaranteed never to change in the future. This allows
applications to identify critical log events without doing string matching on
the <span class="docutils literal">MESSAGE</span> field.</p>
<dl class="simple">
<dt><span class="docutils literal"><span class="pre">MESSAGE_ID=8ae2f3fb-2dbe-498e-8fbd-012d40afa361</span></span></dt>
<dd><p>Generated by the QEMU driver when it identifies a QEMU system emulator
binary, but is unable to extract information about its capabilities. This is
usually an indicator of a broken QEMU build or installation. When this is
emitted, the <span class="docutils literal">LIBVIRT_QEMU_BINARY</span> message field will provide the full path
of the QEMU binary that failed.</p>
</dd>
</dl>
<p>The <span class="docutils literal">journalctl</span> command can be used to search the journal matching on
specific message ID values</p>
<pre class="literal-block">$ journalctl MESSAGE_ID=8ae2f3fb-2dbe-498e-8fbd-012d40afa361 --output=json
{ ...snip...
  "LIBVIRT_SOURCE" : "file",
  "PRIORITY" : "3",
  "CODE_FILE" : "qemu/qemu_capabilities.c",
  "CODE_LINE" : "2770",
  "CODE_FUNC" : "virQEMUCapsLogProbeFailure",
  "MESSAGE_ID" : "8ae2f3fb-2dbe-498e-8fbd-012d40afa361",
  "LIBVIRT_QEMU_BINARY" : "/bin/qemu-system-xtensa",
  "MESSAGE" : "Failed to probe capabilities for /bin/qemu-system-xtensa:" \
              "internal error: Child process (LC_ALL=C LD_LIBRARY_PATH=/home/berrange" \
              "/src/virt/libvirt/src/.libs PATH=/usr/lib64/ccache:/usr/local/sbin:" \
              "/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin HOME=/root " \
              "USER=root LOGNAME=root /bin/qemu-system-xtensa -help) unexpected " \
              "exit status 127: /bin/qemu-system-xtensa: error while loading shared " \
              "libraries: libglapi.so.0: cannot open shared object file: No such " \
              "file or directory\n" }</pre>
</div>
</div>
<div class="section" id="examples">
<h1><a class="toc-backref" href="#id7">Examples</a><a class="headerlink" href="#examples" title="Link to this headline">¶</a></h1>
<p>Examples with useful log settings along with more information on how to properly
configure logging for various situations can be found in the
<a class="reference external" href="kbase/debuglogs.html">logging knowledge base article</a>.</p>
</div>
</div>
    </div>
    <div id="nav">
      <div id="home">
        <a href="index.html">Home</a>
      </div>
      <div id="jumplinks">
        <ul>
          <li>
            <a href="downloads.html">Download</a>
          </li>
          <li>
            <a href="contribute.html">Contribute</a>
          </li>
          <li>
            <a href="docs.html">Docs</a>
          </li>
        </ul>
      </div>
      <div id="search">
        <form id="simplesearch" action="https://www.google.com/search" enctype="application/x-www-form-urlencoded" method="get">
          <div>
            <input id="searchsite" name="sitesearch" type="hidden" value="libvirt.org"/>
            <input id="searchq" name="q" type="text" size="12" value=""/>
            <input name="submit" type="submit" value="Go"/>
          </div>
        </form>
        <div id="advancedsearch">
          <span>
            <input type="radio" name="what" id="whatwebsite" checked="checked" value="website"/>
            <label for="whatwebsite">Website</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatwiki" value="wiki"/>
            <label for="whatwiki">Wiki</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatdevs" value="devs"/>
            <label for="whatdevs">Developers list</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatusers" value="users"/>
            <label for="whatusers">Users list</label>
          </span>
        </div>
      </div>
    </div>
    <div id="footer">
      <div id="contact">
        <h3>Contact</h3>
        <ul>
          <li>
            <a href="contact.html#mailing-lists">email</a>
          </li>
          <li>
            <a href="contact.html#irc">irc</a>
          </li>
        </ul>
      </div>
      <div id="community">
        <h3>Community</h3>
        <ul>
          <li>
            <a href="https://twitter.com/hashtag/libvirt">twitter</a>
          </li>
          <li>
            <a href="https://stackoverflow.com/questions/tagged/libvirt">stackoverflow</a>
          </li>
          <li>
            <a href="https://serverfault.com/questions/tagged/libvirt">serverfault</a>
          </li>
        </ul>
      </div>
      <div id="contribute">
        <h3>Contribute</h3>
        <ul>
          <li>
            <a href="https://gitlab.com/libvirt/libvirt/-/blob/master/docs/logging.rst">edit this page</a>
          </li>
        </ul>
      </div>
      <div id="conduct">
            Participants in the libvirt project agree to abide by <a href="governance.html#code-of-conduct">the project code of conduct</a></div>
      <br class="clear"/>
    </div>
  </body>
</html>
