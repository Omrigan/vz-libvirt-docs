<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <!--
        This file is autogenerated from docs/api.rst
        Do not edit this file. Changes will be lost.
      -->
  <!--
        This page was generated at Wed Apr 19 07:14:27 2023 UTC.
      -->
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" type="text/css" href="css/main.css"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/>
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/>
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/>
    <link rel="manifest" href="/manifest.json"/>
    <meta name="theme-color" content="#ffffff"/>
    <title>libvirt: The libvirt API concepts</title>
    <meta name="description" content="libvirt, virtualization, virtualization API"/>
    <script type="text/javascript" src="js/main.js">
      <!--// forces non-empty element-->
    </script>
  </head>
  <body onload="pageload()">
    <div id="body">
      <div class="document" id="the-libvirt-api-concepts">
<h1>The libvirt API concepts</h1>

<p>This page describes the main principles and architecture choices behind
the definition of the libvirt API:</p>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#objects-exposed" id="id1">Objects Exposed</a></p></li>
<li><p><a class="reference internal" href="#functions-and-naming-conventions" id="id2">Functions and Naming Conventions</a></p></li>
<li><p><a class="reference internal" href="#the-libvirt-drivers" id="id3">The libvirt Drivers</a></p></li>
<li><p><a class="reference internal" href="#daemon-and-remote-access" id="id4">Daemon and Remote Access</a></p></li>
</ul>
</div>
<div class="section" id="objects-exposed">
<h1><a class="toc-backref" href="#id1">Objects Exposed</a><a class="headerlink" href="#objects-exposed" title="Link to this headline">¶</a></h1>
<p>As defined in the <a class="reference external" href="goals.html">goals section</a>, the libvirt API is
designed to expose all the resources needed to manage the virtualization
support of recent operating systems. The first object manipulated
through the API is the <span class="docutils literal">virConnectPtr</span>, which represents the
connection to a hypervisor. Any application using libvirt is likely to
start using the API by calling one of <a class="reference external" href="html/libvirt-libvirt-host.html#virConnectOpen">the virConnectOpen
functions</a>. You will
note that those functions take a name argument which is actually a
<a class="reference external" href="uri.html">connection URI</a> to select the right hypervisor to open. A
URI is needed to allow remote connections and also select between
different possible hypervisors. For example, on a Linux system it may be
possible to use both KVM and LinuxContainers on the same node. A NULL
name will default to a preselected hypervisor, but it's probably not a
wise thing to do in most cases. See the <a class="reference external" href="uri.html">connection URI</a>
page for a full descriptions of the values allowed.</p>
<p>OnDevice the application obtains a
<a class="reference external" href="html/libvirt-libvirt-host.html#virConnectPtr">virConnectPtr</a>
connection to the hypervisor it can then use it to manage the
hypervisor's available domains and related virtualization resources,
such as storage and networking. All those are exposed as first class
objects and connected to the hypervisor connection (and the node or
cluster where it is available).</p>
<p><img alt="first class objects exposed by the API" src="images/libvirt-object-model.png"/></p>
<p>The figure above shows the five main objects exported by the API:</p>
<ul>
<li><p><a class="reference external" href="html/libvirt-libvirt-host.html#virConnectPtr">virConnectPtr</a></p>
<p>Represents the connection to a hypervisor. Use one of the
<a class="reference external" href="html/libvirt-libvirt-host.html#virConnectOpen">virConnectOpen</a>
functions to obtain connection to the hypervisor which is then used
as a parameter to other connection API's.</p>
</li>
<li><p><a class="reference external" href="html/libvirt-libvirt-domain.html#virDomainPtr">virDomainPtr</a></p>
<p>Represents one domain either active or defined (i.e. existing as
permanent config file and storage but not currently running on that
node). The function
<a class="reference external" href="html/libvirt-libvirt-domain.html#virConnectListAllDomains">virConnectListAllDomains</a>
lists all the domains for the hypervisor.</p>
</li>
<li><p><a class="reference external" href="html/libvirt-libvirt-network.html#virNetworkPtr">virNetworkPtr</a></p>
<p>Represents one network either active or defined (i.e. existing as
permanent config file and storage but not currently activated). The
function
<a class="reference external" href="html/libvirt-libvirt-network.html#virConnectListAllNetworks">virConnectListAllNetworks</a>
lists all the virtualization networks for the hypervisor.</p>
</li>
<li><p><a class="reference external" href="html/libvirt-libvirt-storage.html#virStorageVolPtr">virStorageVolPtr</a></p>
<p>Represents one storage volume generally used as a block device
available to one of the domains. The function
<a class="reference external" href="html/libvirt-libvirt-storage.html#virStorageVolLookupByPath">virStorageVolLookupByPath</a>
finds the storage volume object based on its path on the node.</p>
</li>
<li><p><a class="reference external" href="html/libvirt-libvirt-storage.html#virStoragePoolPtr">virStoragePoolPtr</a></p>
<p>Represents a storage pool, which is a logical area used to allocate
and store storage volumes. The function
<a class="reference external" href="html/libvirt-libvirt-storage.html#virConnectListAllStoragePools">virConnectListAllStoragePools</a>
lists all of the virtualization storage pools on the hypervisor. The
function
<a class="reference external" href="html/libvirt-libvirt-storage.html#virStoragePoolLookupByVolume">virStoragePoolLookupByVolume</a>
finds the storage pool containing a given storage volume.</p>
</li>
</ul>
<p>Most objects manipulated by the library can also be represented using
XML descriptions. This is used primarily to create those object, but is
also helpful to modify or save their description back.</p>
<p>Domains, networks, and storage pools can be either <span class="docutils literal">active</span> i.e.
either running or available for immediate use, or <span class="docutils literal">defined</span> in which
case they are inactive but there is a permanent definition available in
the system for them. Based on this they can be activated dynamically in
order to be used.</p>
<p>Most objects can also be named in various ways:</p>
<ul>
<li><p><span class="docutils literal">name</span></p>
<p>A user friendly identifier but whose uniqueness cannot be guaranteed
between two nodes.</p>
</li>
<li><p><span class="docutils literal">ID</span></p>
<p>A runtime unique identifier provided by the hypervisor for one given
activation of the object; however, it becomes invalid once the
resource is deactivated.</p>
</li>
<li><p><span class="docutils literal">UUID</span></p>
<p>A 16 byte unique identifier as defined in <a class="reference external" href="https://www.ietf.org/rfc/rfc4122.txt">RFC
4122</a>, which is guaranteed
to be unique for long term usage and across a set of nodes.</p>
</li>
</ul>
</div>
<div class="section" id="functions-and-naming-conventions">
<h1><a class="toc-backref" href="#id2">Functions and Naming Conventions</a><a class="headerlink" href="#functions-and-naming-conventions" title="Link to this headline">¶</a></h1>
<p>The naming of the functions present in the library is usually composed
by a prefix describing the object associated to the function and a verb
describing the action on that object.</p>
<p>For each first class object you will find APIs for the following
actions:</p>
<ul>
<li><p><strong>Lookup</strong> [...LookupBy...]</p>
<p>Used to perform lookups on objects by some type of identifier, such
as:</p>
<ul class="simple">
<li><p><a class="reference external" href="html/libvirt-libvirt-domain.html#virDomainLookupByID">virDomainLookupByID</a></p></li>
<li><p><a class="reference external" href="html/libvirt-libvirt-domain.html#virDomainLookupByName">virDomainLookupByName</a></p></li>
<li><p><a class="reference external" href="html/libvirt-libvirt-domain.html#virDomainLookupByUUID">virDomainLookupByUUID</a></p></li>
<li><p><a class="reference external" href="html/libvirt-libvirt-domain.html#virDomainLookupByUUIDString">virDomainLookupByUUIDString</a></p></li>
</ul>
</li>
<li><p><strong>Enumeration</strong> [virConnectList..., virConnectNumOf...]</p>
<p>Used to enumerate a set of object available to a given hypervisor
connection such as:</p>
<ul class="simple">
<li><p><a class="reference external" href="html/libvirt-libvirt-domain.html#virConnectListDomains">virConnectListDomains</a></p></li>
<li><p><a class="reference external" href="html/libvirt-libvirt-domain.html#virConnectNumOfDomains">virConnectNumOfDomains</a></p></li>
<li><p><a class="reference external" href="html/libvirt-libvirt-network.html#virConnectListNetworks">virConnectListNetworks</a></p></li>
<li><p><a class="reference external" href="html/libvirt-libvirt-storage.html#virConnectListStoragePools">virConnectListStoragePools</a></p></li>
</ul>
</li>
<li><p><strong>Description</strong> [...GetInfo]</p>
<p>Generic accessor providing a set of generic information about an
object, such as:</p>
<ul class="simple">
<li><p><a class="reference external" href="html/libvirt-libvirt-host.html#virNodeGetInfo">virNodeGetInfo</a></p></li>
<li><p><a class="reference external" href="html/libvirt-libvirt-domain.html#virDomainGetInfo">virDomainGetInfo</a></p></li>
<li><p><a class="reference external" href="html/libvirt-libvirt-storage.html#virStoragePoolGetInfo">virStoragePoolGetInfo</a></p></li>
<li><p><a class="reference external" href="html/libvirt-libvirt-storage.html#virStorageVolGetInfo">virStorageVolGetInfo</a></p></li>
</ul>
</li>
<li><p><strong>Accessors</strong> [...Get..., ...Set...]</p>
<p>Specific accessors used to query or modify data for the given object,
such as:</p>
<ul class="simple">
<li><p><a class="reference external" href="html/libvirt-libvirt-host.html#virConnectGetType">virConnectGetType</a></p></li>
<li><p><a class="reference external" href="html/libvirt-libvirt-domain.html#virDomainGetMaxMemory">virDomainGetMaxMemory</a></p></li>
<li><p><a class="reference external" href="html/libvirt-libvirt-domain.html#virDomainSetMemory">virDomainSetMemory</a></p></li>
<li><p><a class="reference external" href="html/libvirt-libvirt-domain.html#virDomainGetVcpus">virDomainGetVcpus</a></p></li>
<li><p><a class="reference external" href="html/libvirt-libvirt-storage.html#virStoragePoolSetAutostart">virStoragePoolSetAutostart</a></p></li>
<li><p><a class="reference external" href="html/libvirt-libvirt-network.html#virNetworkGetBridgeName">virNetworkGetBridgeName</a></p></li>
</ul>
</li>
<li><p><strong>Creation</strong> [...Create, ...CreateXML]</p>
<p>Used to create and start objects. The ...CreateXML APIs will create
the object based on an XML description, while the ...Create APIs will
create the object based on existing object pointer, such as:</p>
<ul class="simple">
<li><p><a class="reference external" href="html/libvirt-libvirt-domain.html#virDomainCreate">virDomainCreate</a></p></li>
<li><p><a class="reference external" href="html/libvirt-libvirt-domain.html#virDomainCreateXML">virDomainCreateXML</a></p></li>
<li><p><a class="reference external" href="html/libvirt-libvirt-network.html#virNetworkCreate">virNetworkCreate</a></p></li>
<li><p><a class="reference external" href="html/libvirt-libvirt-network.html#virNetworkCreateXML">virNetworkCreateXML</a></p></li>
</ul>
</li>
<li><p><strong>Destruction</strong> [...Destroy]</p>
<p>Used to shutdown or deactivate and destroy objects, such as:</p>
<ul class="simple">
<li><p><a class="reference external" href="html/libvirt-libvirt-domain.html#virDomainDestroy">virDomainDestroy</a></p></li>
<li><p><a class="reference external" href="html/libvirt-libvirt-network.html#virNetworkDestroy">virNetworkDestroy</a></p></li>
<li><p><a class="reference external" href="html/libvirt-libvirt-storage.html#virStoragePoolDestroy">virStoragePoolDestroy</a></p></li>
</ul>
</li>
</ul>
<p>Note: functions returning vir*Ptr (like the virDomainLookup functions)
allocate memory which needs to be freed by the caller by the
corresponding vir*Free function (e.g. virDomainFree for a virDomainPtr
object).</p>
<p>For more in-depth details of the storage related APIs see <a class="reference external" href="storage.html">the storage
management page</a>.</p>
</div>
<div class="section" id="the-libvirt-drivers">
<h1><a class="toc-backref" href="#id3">The libvirt Drivers</a><a class="headerlink" href="#the-libvirt-drivers" title="Link to this headline">¶</a></h1>
<p>Drivers are the basic building block for libvirt functionality to
support the capability to handle specific hypervisor driver calls.
Drivers are discovered and registered during connection processing as
part of the
<a class="reference external" href="html/libvirt-libvirt-host.html#virInitialize">virInitialize</a>
API. Each driver has a registration API which loads up the driver
specific function references for the libvirt APIs to call. The following
is a simplistic view of the hypervisor driver mechanism. Consider the
stacked list of drivers as a series of modules that can be plugged into
the architecture depending on how libvirt is configured to be built.</p>
<p><img alt="The libvirt driver architecture" src="images/libvirt-driver-arch.png"/></p>
<p>The driver architecture is also used to support other virtualization
components such as storage, storage pools, host device, networking,
network interfaces, and network filters.</p>
<p>See the <a class="reference external" href="drivers.html">libvirt drivers</a> page for more information on
hypervisor and storage specific drivers.</p>
<p>Not all drivers support every virtualization function possible. The
<a class="reference external" href="hvsupport.html">libvirt API support matrix</a> lists the various
functions and support found in each driver by the version support was
added into libvirt.</p>
</div>
<div class="section" id="daemon-and-remote-access">
<h1><a class="toc-backref" href="#id4">Daemon and Remote Access</a><a class="headerlink" href="#daemon-and-remote-access" title="Link to this headline">¶</a></h1>
<p>Access to libvirt drivers is primarily handled by the libvirtd daemon
through the <a class="reference external" href="remote.html">remote</a> driver via an
<a class="reference external" href="kbase/internals/rpc.html">RPC</a>. Some hypervisors do support client-side
connections and responses, such as Test, OpenVZ, VMware, VirtualBox
(vbox), ESX, Hyper-V, Xen, and Virtuozzo. The libvirtd daemon service is
started on the host at system boot time and can also be restarted at any
time by a properly privileged user, such as root. The libvirtd daemon
uses the same libvirt API
<a class="reference external" href="html/libvirt-libvirt-host.html#virInitialize">virInitialize</a>
sequence as applications for client-side driver registrations, but then
extends the registered driver list to encompass all known drivers
supported for all driver types supported on the host.</p>
<p>The libvirt client <a class="reference external" href="apps.html">applications</a> use a <a class="reference external" href="uri.html">URI</a>
to obtain the <span class="docutils literal">virConnectPtr</span>. The <span class="docutils literal">virConnectPtr</span> keeps track of
the driver connection plus a variety of other connections (network,
interface, storage, etc.). The <span class="docutils literal">virConnectPtr</span> is then used as a
parameter to other virtualization functions
(see <a class="reference internal" href="#functions-and-naming-conventions">Functions and Naming Conventions</a>).
Depending upon the driver being used, calls will be routed through the remote
driver to the libvirtd daemon. The daemon will reference the connection
specific driver in order to retrieve the requested information and then
pass back status and/or data through the connection back to the
application. The application can then decide what to do with that data,
such as display, write log data, etc. <a class="reference external" href="migration.html">Migration</a> is
an example of many facets of the architecture in use.</p>
<p><img alt="The libvirt daemon and remote architecture" src="images/libvirt-daemon-arch.png"/></p>
<p>The key takeaway from the above diagram is that there is a remote driver
which handles transactions for a majority of the drivers. The libvirtd
daemon running on the host will receive transaction requests from the
remote driver and will then query the hypervisor driver as specified in
the <span class="docutils literal">virConnectPtr</span> in order to fetch the data. The data will then be
returned through the remote driver to the client application for
processing.</p>
<p>If you are interested in contributing to libvirt, read the
<a class="reference external" href="https://wiki.libvirt.org/page/FAQ">FAQ</a> and
<a class="reference external" href="hacking.html">hacking</a> guidelines to gain an understanding of basic
rules and guidelines. In order to add new API functionality follow the
instructions regarding <a class="reference external" href="api_extension.html">implementing a new API in
libvirt</a>.</p>
</div>
</div>
    </div>
    <div id="nav">
      <div id="home">
        <a href="index.html">Home</a>
      </div>
      <div id="jumplinks">
        <ul>
          <li>
            <a href="downloads.html">Download</a>
          </li>
          <li>
            <a href="contribute.html">Contribute</a>
          </li>
          <li>
            <a href="docs.html">Docs</a>
          </li>
        </ul>
      </div>
      <div id="search">
        <form id="simplesearch" action="https://www.google.com/search" enctype="application/x-www-form-urlencoded" method="get">
          <div>
            <input id="searchsite" name="sitesearch" type="hidden" value="libvirt.org"/>
            <input id="searchq" name="q" type="text" size="12" value=""/>
            <input name="submit" type="submit" value="Go"/>
          </div>
        </form>
        <div id="advancedsearch">
          <span>
            <input type="radio" name="what" id="whatwebsite" checked="checked" value="website"/>
            <label for="whatwebsite">Website</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatwiki" value="wiki"/>
            <label for="whatwiki">Wiki</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatdevs" value="devs"/>
            <label for="whatdevs">Developers list</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatusers" value="users"/>
            <label for="whatusers">Users list</label>
          </span>
        </div>
      </div>
    </div>
    <div id="footer">
      <div id="contact">
        <h3>Contact</h3>
        <ul>
          <li>
            <a href="contact.html#mailing-lists">email</a>
          </li>
          <li>
            <a href="contact.html#irc">irc</a>
          </li>
        </ul>
      </div>
      <div id="community">
        <h3>Community</h3>
        <ul>
          <li>
            <a href="https://twitter.com/hashtag/libvirt">twitter</a>
          </li>
          <li>
            <a href="https://stackoverflow.com/questions/tagged/libvirt">stackoverflow</a>
          </li>
          <li>
            <a href="https://serverfault.com/questions/tagged/libvirt">serverfault</a>
          </li>
        </ul>
      </div>
      <div id="contribute">
        <h3>Contribute</h3>
        <ul>
          <li>
            <a href="https://gitlab.com/libvirt/libvirt/-/blob/master/docs/api.rst">edit this page</a>
          </li>
        </ul>
      </div>
      <div id="conduct">
            Participants in the libvirt project agree to abide by <a href="governance.html#code-of-conduct">the project code of conduct</a></div>
      <br class="clear"/>
    </div>
  </body>
</html>
